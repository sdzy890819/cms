define(["app","jquery","../data/getData","../moduls/Tool"],function(i,e,n,s){return{init:function(i){i.$uibModal;i.$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"../template/template/permissionsPop.html",controller:function(s,a,c,o){function t(i){return 1==i?"MENU":"BUTTON"}angular.extend(s,{titelement:{close:!0},title:"编辑权限列表",save:function(e){//保存
i.save(e,s.data)},cancel:function(e){//取消
i.cancel(e,s.data)},select:function(s){var a=s.currentTarget,c=a.dataset.id,o=e(".selectAllInput");a.checked?(a.checked=!0,n.permission.createPositionPermission({positionId:i.obj.id,permissionId:c,callback:function(i){layui.use(["layer"],function(){var e=layui.layer;e.msg(i.message)})}})):(a.checked=!1,e.each(o,function(i,e){e.checked=!1}),n.permission.delPositionPermission({positionId:i.obj.id,permissionId:c,callback:function(i){layui.use(["layer"],function(){var e=layui.layer;e.msg(i.message)})}}))},selectAll:function(s){var a=s.currentTarget,c=e(".permissions-pop"),o=c.find("input[name=permission]"),t=[];a.checked?e.each(o,function(i,e){e.checked=!0,t.push(e.dataset.id)}):e.each(o,function(i,e){e.checked=!1}),n.permission.setPositionPermissions({positionId:i.obj.id,permissionIds:t.join(","),callback:function(i){layui.use(["layer"],function(){var e=layui.layer;e.msg(i.message)})}})},close:function(){c.dismiss("cancel")}});var l=[];n.permission.listPositionPermission({positionId:i.obj.id,callback:function(i){l=i.data}}),s.allchecked=!0,n.permission.listPermission({//新闻栏目
callback:function(i){var n=[];e.each(i.data,function(i,a){a.permission.typeStr=t(a.permission.type),a.permission.ischecked=e.inArray(a.permission.id,l)!=-1,a.permission.specialCls=!0,a.permission.ischecked||(s.allchecked=!1),n.push(a.permission),e.each(a.permissions,function(i,a){a.typeStr=t(a.type),a.ischecked=e.inArray(a.id,l)!=-1,a.ischecked||(s.allchecked=!1),n.push(a)})}),s.listPermissionData=n,s.$apply()}}),s.isChecked=function(i){return e.inArray(i,l)!=-1},s.isCheckedAll=function(){},s.checkedAll=function(i,e){}}})}}});