define(["app","jquery","../data/getData","../moduls/Tool"],function(app,$,getData,tool){return{init:function(obj){obj.$uibModal;obj.$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"../template/template/permissionsPop.html",controller:function($scope,$state,$uibModalInstance,$css){function typeStr(t){return 1==t?"MENU":"BUTTON"}angular.extend($scope,{titelement:{close:!0},title:"编辑权限列表",save:function(arr){obj.save(arr,$scope.data)},cancel:function(arr){obj.cancel(arr,$scope.data)},select:function(event){var currentTarget=event.currentTarget,permissionId=currentTarget.dataset.id,selectAllInput=$(".selectAllInput");currentTarget.checked?(currentTarget.checked=!0,getData.permission.createPositionPermission({positionId:obj.obj.id,permissionId:permissionId,callback:function(_data){layui.use(["layer"],function(){layui.layer.msg(_data.message)})}})):(currentTarget.checked=!1,$.each(selectAllInput,function(i,obj){obj.checked=!1}),getData.permission.delPositionPermission({positionId:obj.obj.id,permissionId:permissionId,callback:function(_data){layui.use(["layer"],function(){layui.layer.msg(_data.message)})}}))},selectAll:function(event){var currentTarget=event.currentTarget,dom=$(".permissions-pop"),checkboxs=dom.find("input[name=permission]"),permissionIds=[];currentTarget.checked?$.each(checkboxs,function(i,obj){obj.checked=!0,permissionIds.push(obj.dataset.id)}):$.each(checkboxs,function(i,obj){obj.checked=!1}),getData.permission.setPositionPermissions({positionId:obj.obj.id,permissionIds:permissionIds.join(","),callback:function(_data){layui.use(["layer"],function(){layui.layer.msg(_data.message)})}})},close:function(){$uibModalInstance.dismiss("cancel")}});var currentPermissionIds=[];getData.permission.listPositionPermission({positionId:obj.obj.id,callback:function(_data){currentPermissionIds=_data.data}}),$scope.allchecked=!0,getData.permission.listPermission({callback:function(_data){var data=[];$.each(_data.data,function(i,obj){obj.permission.typeStr=typeStr(obj.permission.type),obj.permission.ischecked=-1!=$.inArray(obj.permission.id,currentPermissionIds),obj.permission.specialCls=!0,obj.permission.ischecked||($scope.allchecked=!1),data.push(obj.permission),$.each(obj.permissions,function(j,ps){ps.typeStr=typeStr(ps.type),ps.ischecked=-1!=$.inArray(ps.id,currentPermissionIds),ps.ischecked||($scope.allchecked=!1),data.push(ps)})}),$scope.listPermissionData=data,$scope.$apply()}}),$scope.isChecked=function(id){return-1!=$.inArray(id,currentPermissionIds)},$scope.isCheckedAll=function(){},$scope.checkedAll=function(obj,_detail){}}})}}});