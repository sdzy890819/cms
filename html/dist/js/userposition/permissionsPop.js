define(["app","jquery","../data/getData","../moduls/Tool"],function(i,e,n,s){return{init:function(i){i.$uibModal;i.$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"../template/template/permissionsPop.html",controller:function(s,c,o,a){function t(i){return 1==i?"MENU":"BUTTON"}angular.extend(s,{titelement:{close:!0},title:"编辑权限列表",save:function(e){i.save(e,s.data)},cancel:function(e){i.cancel(e,s.data)},select:function(s){var c=s.currentTarget,o=c.dataset.id,a=e(".selectAllInput");c.checked?(c.checked=!0,n.permission.createPositionPermission({positionId:i.obj.id,permissionId:o,callback:function(i){layui.use(["layer"],function(){layui.layer.msg(i.message)})}})):(c.checked=!1,e.each(a,function(i,e){e.checked=!1}),n.permission.delPositionPermission({positionId:i.obj.id,permissionId:o,callback:function(i){layui.use(["layer"],function(){layui.layer.msg(i.message)})}}))},selectAll:function(s){var c=s.currentTarget,o=e(".permissions-pop").find("input[name=permission]"),a=[];c.checked?e.each(o,function(i,e){e.checked=!0,a.push(e.dataset.id)}):e.each(o,function(i,e){e.checked=!1}),n.permission.setPositionPermissions({positionId:i.obj.id,permissionIds:a.join(","),callback:function(i){layui.use(["layer"],function(){layui.layer.msg(i.message)})}})},close:function(){o.dismiss("cancel")}});var l=[];n.permission.listPositionPermission({positionId:i.obj.id,callback:function(i){l=i.data}}),s.allchecked=!0,n.permission.listPermission({callback:function(i){var n=[];e.each(i.data,function(i,c){c.permission.typeStr=t(c.permission.type),c.permission.ischecked=-1!=e.inArray(c.permission.id,l),c.permission.specialCls=!0,c.permission.ischecked||(s.allchecked=!1),n.push(c.permission),e.each(c.permissions,function(i,c){c.typeStr=t(c.type),c.ischecked=-1!=e.inArray(c.id,l),c.ischecked||(s.allchecked=!1),n.push(c)})}),s.listPermissionData=n,s.$apply()}}),s.isChecked=function(i){return-1!=e.inArray(i,l)},s.isCheckedAll=function(){},s.checkedAll=function(i,e){}}})}}});