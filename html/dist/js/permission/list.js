define(["require","app","jquery","../data/getData","./form",,"formlist","fixedNav","position","../moduls/service","../moduls/factory"],function(e,t,i,n,a){t.directive("permissionList",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/list.html",controller:function(t,s,l,o,r,c){function d(){n.permission.listPermission({callback:function(e){var n=[{name:"ID",key:"id",width:"200"},{name:"权限名",key:"name"},{name:"父类ID",key:"parentId"},{name:"权限代码",key:"permission"},{name:"应用设备",key:"platformStr"},{name:"类型",key:"typeStr"},{name:"操作",width:"200",class:"center"}],a=[];i.each(e.data,function(e,t){t.permission.parentId="",t.permission.typeStr="MENU",a.push(t.permission),i.each(t.permissions,function(e,t){t.typeStr="BUTTON",a.push(t)})}),t.listdata={//确认按钮
title:t.title,table:{select:!0,th:n,td:r.setArr(a,n),edit:[{cls:"edit",name:"编辑",evt:t.edit},{cls:"del",name:"删除",evt:t.del}]}},
// GenerateArrList.extendType($scope.listdata.table.td,$scope.listdata.table.th,['width','name']); //把TH 中的出name属性以外的属性合传给td
r.extendChild(t.listdata.table.td,t.listdata.table.edit,"edit"),i.each(t.listdata.table.td,function(e,i){var n=[];"MENU"==i.typeStr&&(n.push({cls:"add",name:"新增子权限",evt:t.addChildPermission}),i.cls="special"),n.push({cls:"edit",name:"编辑",evt:t.edit},{cls:"del",name:"删除",evt:t.del}),i.list.edit=n}),t.$apply()}})}t.title="权限列表",t.$parent.menu.push({name:t.title}),//栏目
angular.extend(t,{add:function(e){//保存
s.alert({text:"你的ID为："+e,btn:["确定","取消"],fn:function(e){//确定
layer.close(e)}})},edit:function(t,i){//保存
e(["../common/editPop"],function(e){function i(e){var i={data:t};e(i)}e.init({obj:t,list:a,$uibModal:l,updateData:i,save:function(e,t){var i,a,s;i="BUTTON"==e.type?2:1,a="YES"==e.showFlag?1:0,"CMS"==e.platform?s=1:"APP"==e.platform&&(s=2),n.permission.updatePermission({id:t.id,name:e.name,description:e.description,type:i,url:e.url,sort:e.sort,parentId:e.parentId,showFlag:a,platform:s,permission:e.permission,callback:function(e){layui.use(["layer"],function(){var t=layui.layer;t.msg(e.message),0==e.code&&c.reload()})}})},close:function(){l.dismiss("cancel")},callback:function(e,t){t(e)}})})},addChildPermission:function(t,i){e(["../common/editPop"],function(e){function i(e){var i={data:{parentId:t.id}};e(i)}e.init({obj:t,list:a,$uibModal:l,updateData:i,save:function(e,t){var i,a,s;i="BUTTON"==e.type?2:1,a="YES"==e.showFlag?1:0,"CMS"==e.platform?s=1:"APP"==e.platform&&(s=2),n.permission.createPermission({name:e.name,description:e.description,type:i,url:e.url,sort:e.sort,parentId:e.parentId,showFlag:a,platform:s,permission:e.permission,callback:function(e){layui.use(["layer"],function(){var t=layui.layer;t.msg(e.message),console.log(e),0==e.code&&c.reload()})}})},close:function(){l.dismiss("cancel")},callback:function(e,t){t(e)}})})},del:function(e){s.alert({text:"您确定要删除"+e.name+"吗",btn:["确定","取消"],fn:function(){n.permission.delPermission(e)}}),e.callback=function(e){layui.use(["layer"],function(){var t=layui.layer;t.msg(e.message),c.reload()})}},filter:[]}),d()},link:function(e,t){}}})});