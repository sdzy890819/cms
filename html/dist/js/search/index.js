define(["require","app","jquery","/js/moduls/Tool.js"],function(require,app,$,Tool){app.directive("search",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{list:"=list"},templateUrl:"../template/common/search.html",controller:function($scope,pop,$uibModal,$css,GenerateArrList,$state){},link:function($scope,element){$scope.selects=[],layui.use(["form","layedit","laydate"],function(){var form=layui.form();layui.layer,layui.layedit,layui.laydate;angular.extend($scope,{selectDate:function($event){layui.laydate({elem:$event.target,istime:!0,format:"YYYY-MM-DD hh:mm:ss",festival:!0})},return:function(){$scope.list.return()},formRepeat:function(elem){function getSelect(_obj){var self=this;$.each(self.select,function(j,arr){if(arr[0].title==_obj.elem.name){var obj=arr[_obj.elem.selectedIndex];if(obj.title=_obj.elem.name,$scope.selects.length){var b=!1;$.each($scope.selects,function(k,select){_obj.elem.name;select.title==_obj.elem.name&&(b=!0,$scope.selects[k]=obj)}),b||$scope.selects.push(obj)}else $scope.selects.push(obj);if(obj.name.indexOf("请选择")>-1)return;self.callback&&self.callback({obj:obj,index:_obj.elem.selectedIndex,title:_obj.elem.name,name:_obj.name,callback:function(){form.render()}})}})}form.render(),form.verify({title:function(value){if(value.length<1)return"内容至少得1个字符啊"},http:function(value){var reg=/^http:\/\/([\w-]+\.)+[\w-]+(\/[\w-.\/?%&=]*)?$/;if(value.search(reg)<0)return"请输入正确的域名（例：http://www.xy.com）"},path:function(value){var reg=/[\s,，.。\|\*\#]/;if(null!=value.match(reg))return console.log(value.match(reg)),"请输入正确的路经（例：xy/xy）"},select:function(value,ele){if(value.indexOf("请选择")>-1&&0==ele.parentNode.selectedIndex)return value},html:function(value){var reg=/^\w+\.html/;if(value.search(reg)<0)return"请输入正确文件名（例：index.html）"}}),$(".search input").keydown(function(event){13==event.keyCode&&layenter.call($(".search-submit .btn")[0])}),form.on("submit(searchForm)",function(data){var b=!1;return $.each(data.field,function(key,value){value.length&&value.indexOf("请选择")<0&&(b=!0)}),b?(data.field.selects=$scope.selects,$scope.list.submit(data.field,data),!1):(layui.use("layer",function(){var layer=layui.layer;layer.msg("请至少填写一项",{icon:2,anim:6})}),!1)}),form.on("select",function(_obj){$.each($scope.list.list,function(i,obj){"select"==this.type&&getSelect.call(this,_obj)})})},selectRpeatDone:function(){setTimeout(function(){form.render("select")},100)},checkboxRpeatDone:function(){setTimeout(function(){form.render("checkbox")},100)},radioRpeatDone:function(){setTimeout(function(){form.render("radio")},100)}})})}}})});