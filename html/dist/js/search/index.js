define(["require","app","jquery","/js/moduls/Tool.js"],function(e,t,n,i){t.directive("search",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{list:"=list"},templateUrl:"../template/common/search.html",controller:function(e,t,n,i,l,c){},link:function(e,t){e.selects=[],layui.use(["form","layedit","laydate"],function(){var t=layui.form();layui.layer,layui.layedit,layui.laydate;angular.extend(e,{selectDate:function(e){layui.laydate({elem:e.target,istime:!0,format:"YYYY-MM-DD hh:mm:ss",festival:!0})},return:function(){e.list.return()},submit:function(e){layenter.call(n(".search-submit .btn")[0])},formRepeat:function(i){function l(i){var l=this;n.each(l.select,function(c,a){if(a[0].title==i.elem.name){var r=a[i.elem.selectedIndex];if(r.title=i.elem.name,e.selects.length){var s=!1;n.each(e.selects,function(t,n){i.elem.name;n.title==i.elem.name&&(s=!0,e.selects[t]=r)}),s||e.selects.push(r)}else e.selects.push(r);if(r.name.indexOf("请选择")>-1)return;l.callback&&l.callback({obj:r,index:i.elem.selectedIndex,title:i.elem.name,name:i.name,callback:function(){t.render()}})}})}t.render(),t.verify({title:function(e){if(e.length<1)return"内容至少得1个字符啊"},http:function(e){var t=/^http:\/\/([\w-]+\.)+[\w-]+(\/[\w-./?%&=]*)?$/;if(e.search(t)<0)return"请输入正确的域名（例：http://www.xy.com）"},path:function(e){var t=/[\s,，.。\|\*\#]/;if(null!=e.match(t))return console.log(e.match(t)),"请输入正确的路经（例：xy/xy）"},select:function(e,t){if(e.indexOf("请选择")>-1&&0==t.parentNode.selectedIndex)return e},html:function(e){var t=/^\w+\.html/;if(e.search(t)<0)return"请输入正确文件名（例：index.html）"}}),n(".search input,.search select").keydown(function(e){13==e.keyCode&&layenter.call(n(".search-submit .btn")[0])}),setTimeout(function(){t.on("submit(searchForm)",function(t){var i=!1;return n.each(t.field,function(e,t){t.length&&t.indexOf("请选择")<0&&(i=!0)}),i?(t.field.selects=e.selects,e.list.submit(t.field,t),!1):(layui.use("layer",function(){layui.layer.msg("请至少填写一项",{icon:2,anim:6})}),!1)})},300),t.on("select",function(t){n.each(e.list.list,function(e,n){"select"==this.type&&l.call(this,t)})})},selectRpeatDone:function(){setTimeout(function(){t.render("select")},100)},checkboxRpeatDone:function(){setTimeout(function(){t.render("checkbox")},100)},radioRpeatDone:function(){setTimeout(function(){t.render("radio")},100)}})})}}})});