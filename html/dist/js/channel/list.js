define(["require","app","jquery","../data/getData","./form",,"formlist","fixedNav","position","../moduls/service","../moduls/factory"],function(require,app,$,data,list){app.directive("channelList",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/list.html",controller:function($scope,pop,$uibModal,$css,GenerateArrList,$state){function getDataList(){data.channel.listChannel({callback:function(_data){var th=[{name:"频道名称",key:"channelName",width:"200"},{name:"频道域名",key:"channelUrl"},{name:"频道绝对路径",key:"channelPath"},{name:"模版位置",key:"templatePath"},{name:"频道说明",key:"channelDesc"},{name:"操作",width:"120",class:"center"}];$scope.listdata={title:$scope.title,table:{select:!0,th:th,td:GenerateArrList.setArr(_data.data,th),edit:[{cls:"edit",name:"编辑",evt:$scope.edit},{cls:"del",name:"删除",evt:$scope.del}]}},GenerateArrList.extendChild($scope.listdata.table.td,$scope.listdata.table.edit,"edit"),$scope.$apply()}})}$scope.title="频道列表",$scope.$parent.menu.push({name:$scope.title}),angular.extend($scope,{add:function(id){pop.alert({text:"你的ID为："+id,btn:["确定","取消"],fn:function(index){layer.close(index)}})},edit:function(obj){require(["../common/editPop"],function(pop){function getAddForm(callback){var _data={data:obj};callback(_data)}pop.init({obj:obj,list:list,$uibModal:$uibModal,updateData:getAddForm,save:function(obj,_detail){var categoryId;$.each(obj.selects,function(){"categoryId"==this.title&&(categoryId=this.id)}),data.channel.updateChannel({id:_detail.id,categoryId:categoryId,channelName:obj.channelName,channelUrl:obj.channelUrl,channelPath:obj.channelPath,templatePath:obj.templatePath,channelDesc:obj.channelDesc,callback:function(_data){layui.use(["layer"],function(){var layer=layui.layer;layer.msg(_data.message),$state.reload()})}})},close:function(){$uibModal.dismiss("cancel")},callback:function(list,callback){callback(list)}})})},del:function(obj){pop.alert({text:"您确定要删除"+obj.channelName+"吗",btn:["确定","取消"],fn:function(){data.channel.delChannel(obj)}}),obj.callback=function(_data){layui.use(["layer"],function(){var layer=layui.layer;layer.msg(_data.message),0==_data.code&&$("table").find("tr[data-id="+obj.id+"]").hide()})}},filter:["id","categoryId"]}),getDataList()},link:function($scope,element){}}})});