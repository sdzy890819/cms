define(["app","jquery","../data/getData","../moduls/Tool"],function(app,$,getData,tool){return{init:function(obj){obj.$uibModal;obj.$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"../template/template/channelPop.html",controller:function($scope,$state,$uibModalInstance,$css){angular.extend($scope,{titelement:{close:!0},title:"编辑用户频道列表",save:function(arr){obj.save(arr,$scope.data)},cancel:function(arr){obj.cancel(arr,$scope.data)},select:function(event){var currentTarget=event.currentTarget;currentTarget.checked?getData.userchannel.createUserChannel({userId:obj.obj.userId,channelId:currentTarget.dataset.id,callback:function(_data){layui.use(["layer"],function(){var layer=layui.layer;layer.msg(_data.message)})}}):getData.userchannel.delUserChannel({userId:obj.obj.userId,channelId:currentTarget.dataset.id,callback:function(_data){layui.use(["layer"],function(){var layer=layui.layer;layer.msg(_data.message)})}})},close:function(){$uibModalInstance.dismiss("cancel")}});var currentUserChannelIds=[];getData.userchannel.userChannelIds({userId:obj.obj.userId,callback:function(_data){currentUserChannelIds=_data.data,getData.channel.listChannel({callback:function(_data){$.each(_data.data,function(i,obj){obj.ischecked=$.inArray(obj.id,currentUserChannelIds)!=-1}),$scope.listChannelData=_data.data,$scope.$apply()}})}})}})}}});