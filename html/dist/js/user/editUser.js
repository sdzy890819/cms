define(["app","jquery","../upload/index","../data/getData","form"],function(a,e,i,n){return{init:function(a){var t=a.$uibModal,l=a.list;"array"==e.type(l)&&(l=function(e){e(a.list)}),a.$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"../template/common/addAndEdit.html",size:"lg",controller:function(u,o,d,s,r){u.data=null,angular.extend(u,{titelement:{close:!0},save:function(a){function e(a){layui.use(["layer"],function(){layui.layer.msg(a,{icon:5})})}var i=u.data;if(i.headImage)t=i.headImage.split(".")[1];if(void 0==u.imageInfo)n.user.updateUser({userId:i.userId,headImage:i.headImage,userName:a.userName,realName:a.realName,idfa:a.idfa,pwd:a.pwd,callback:function(a){layui.use(["layer"],function(){layui.layer.msg(a.message)})}});else{var t=u.imageInfo.name.match(/\w+$/)[0];s.base64DataUrl(u.imageInfo).then(function(l){l?n.upload.uploadImage({baseCode:l.split(",")[1],suffix:t,width:100,callback:function(e){var t=e.data;n.user.updateUser({headImage:t.imageUrl,realName:a.realName,userName:a.userName,pwd:a.pwd,userId:i.userId,callback:function(a){layui.use(["layer"],function(){layui.layer.msg(a.message)})}})}}):l?"yes"!=isSize||"yes"!=selectSize||width?"yes"!=isSize||"no"!=selectSize||height||e("请输入高度"):e("请输入高度"):e("请上传图片")})}},cancel:function(e){a.cancel(e,u.data)},close:function(){o.dismiss("cancel")}}),l(function(e){a.callback(e,function(e){u.formdata={title:"编辑",cls:"popedit",list:e,submit:[{name:"确定",evt:"save",icon_cls:"save"}]},a.updateData(function(a){u.data=a.data,u.$$phase||u.$apply()}),u.$$phase||u.$apply()})}),u.$on("formRepeat",function(){e(".layui-upload-button").unbind().click(function(){i.init({data:{obj:{},title:"上传图片",name:"请选择图片",type:"image",event:function(a,i){u.imageInfo=a,console.log(a),s.base64DataUrl(u.imageInfo).then(function(i){var n="<img src='"+a.$ngfDataUrl+"'width='100px' class='thumb'>";e(".imagePre").empty().append(n)}),i.dismiss("cancel")}},$uibModal:t})});var a=e("form.layui-form"),n=(a.find('input[name="isSize"]'),a.find('input[name="selectSize"]').parent().parent()),l=a.find('input[name="imageWidth"]').parent().parent(),o=a.find('input[name="imageHeight"]').parent().parent(),d=!0;o.hide(),layui.use(["form","layedit","laydate"],function(){function a(){0==d?(o.show(),l.hide()):(o.hide(),l.show())}var e=layui.form();layui.layer,layui.layedit,layui.laydate;e.on("radio",function(e){var i=e.elem.name,t=e.value;"isSize"==i?"no"==t?(n.hide(),l.hide(),o.hide()):(n.show(),a()):"selectSize"==i&&(d="no"!=t,a())})})})}})},updateData:function(){}}});