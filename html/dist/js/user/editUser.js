define(["app","jquery","../upload/index","../data/getData","form"],function(a,e,i,n){return{init:function(a){var t=a.$uibModal,l=a.list;"array"==e.type(l)&&(l=function(e){e(a.list)}),a.$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"../template/common/addAndEdit.html",size:"lg",controller:function(o,u,d,s,r){o.data=null,angular.extend(o,{titelement:{close:!0},save:function(a){function e(a){layui.use(["layer"],function(){var e=layui.layer;e.msg(a,{icon:5})})}//保存
var i=o.data;if(i.headImage)var t=i.headImage.split(".")[1];if(void 0==o.imageInfo)n.user.updateUser({userId:i.userId,headImage:i.headImage,realName:a.realName,idfa:a.idfa,pwd:a.pwd,callback:function(a){layui.use(["layer"],function(){var e=layui.layer;e.msg(a.message)})}});else{//图片有变动就继续走上传
var t=o.imageInfo.name.match(/\w+$/)[0];s.base64DataUrl(o.imageInfo).then(function(l){l?n.upload.uploadImage({baseCode:l.split(",")[1],suffix:t,//"文件后缀png|jpg"											
width:100,//需要压缩的长度 可不传											
callback:function(e){var t=e.data;n.user.updateUser({headImage:t.imageUrl,realName:a.realName,pwd:a.pwd,userId:i.userId,callback:function(a){layui.use(["layer"],function(){var e=layui.layer;e.msg(a.message)})}})}}):l?"yes"!=isSize||"yes"!=selectSize||width?"yes"!=isSize||"no"!=selectSize||height||e("请输入高度"):e("请输入高度"):e("请上传图片")})}},cancel:function(e){//取消
a.cancel(e,o.data)},close:function(){u.dismiss("cancel")}}),l(function(e){a.callback(e,function(e){o.formdata={//确认按钮
title:"编辑",cls:"popedit",list:e,submit:[{name:"确定",evt:"save",icon_cls:"save"}]},a.updateData(function(a){o.data=a.data,o.$$phase||o.$apply()}),o.$$phase||o.$apply()})}),o.$on("formRepeat",function(){e(".layui-upload-button").unbind().click(function(){i.init({data:{obj:{},title:"上传图片",name:"请选择图片",type:"image",event:function(a,i){o.imageInfo=a,console.log(a),s.base64DataUrl(o.imageInfo).then(function(i){var n="<img src='"+a.$ngfDataUrl+"'width='100px' class='thumb'>";
// $('.layui-upload-button').empty().append(image);												
e(".imagePre").empty().append(n)}),i.dismiss("cancel")}},$uibModal:t})});var a=e("form.layui-form"),n=(a.find('input[name="isSize"]'),a.find('input[name="selectSize"]')),l=n.parent().parent(),u=a.find('input[name="imageWidth"]'),d=u.parent().parent(),r=a.find('input[name="imageHeight"]'),c=r.parent().parent(),m=!0;c.hide(),layui.use(["form","layedit","laydate"],function(){function a(){0==m?(c.show(),d.hide()):(c.hide(),d.show())}var e=layui.form();layui.layer,layui.layedit,layui.laydate;e.on("radio",function(e){//
var i=e.elem.name,n=e.value;"isSize"==i?"no"==n?(l.hide(),d.hide(),c.hide()):(l.show(),a()):"selectSize"==i&&(m="no"!=n,a())})})})}})},updateData:function(){}}});