define(["require","app","jquery","../data/getData","./addForm","search","./searchForm","formlist","fixedNav","position","../moduls/service","../moduls/factory"],function(t,e,a,n,i,l,c){e.directive("fragmentList",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/list.html",controller:function(e,l,r,d,s,o){function f(t){var a=[{name:"碎片ID",width:"50",key:"id"},{name:"碎片名称",key:"fragmentName"},{name:"最后维护人",key:"editUserName",width:60},{name:"最后维护时间",key:"editTimeStr",width:60},{name:"创建人",key:"createUserName",width:60},{name:"创建时间",key:"createTimeStr",width:80},{name:"修改人",key:"lastModifyUserName",width:60},{name:"修改时间",key:"updateTimeStr",width:80},{name:"操作",width:"100",class:"center"}];e.listdata={title:e.title,table:{select:!0,th:a,td:s.setArr(t.data.list,a),edit:[{cls:"edit",name:"编辑",evt:e.edit},{cls:"edit",name:"碎片维护",evt:e.editFragmentMap},{cls:"del",name:"删除",evt:e.del}]}},s.extendType(e.listdata.table.td,e.listdata.table.th,["width","name"]),s.extendChild(e.listdata.table.td,e.listdata.table.edit,"edit"),e.$apply()}function u(){n.fragment.listFragment({page:m,pageSize:20,callback:function(t){e.page=t.data.page,e.page.jump=function(t){m!=t.curr&&(m=t.curr,u())},f(t)}})}e.title="碎片列表",e.$parent.menu.push({name:e.title}),angular.extend(e,{add:function(t){l.alert({text:"你的ID为："+t,btn:["确定","取消"],fn:function(t){layer.close(t)}})},edit:function(e){t(["../common/editPop"],function(t){t.init({obj:e,list:i,$uibModal:r,updateData:function(t){n.fragment.findFragment({id:e.id,callback:function(e){t(e)}})},save:function(t,e){var i,l;a.each(t.selects,function(){"channelId"==this.title&&(i=this.id),"fragmentClassifyId"==this.title&&(l=this.id)}),n.fragment.updateFragment({id:e.id,channelId:i,fragmentClassifyId:l,fragmentName:t.fragmentName,fragmentModel:t.fragmentModel,sortNum:t.sortNum,callback:function(t){layui.use(["layer"],function(){layui.layer.msg(t.message),0==t.code&&o.reload()})}})},callback:function(t,e){e(t)}})})},editFragmentMap:function(e){t(["../common/editPop"],function(t){t.init({obj:e,list:function(t){var i=[];n.fragment.fragmentMap({id:e.id,callback:function(e){a.each(e.data,function(t,e){i.push({title:t,name:t,type:"text",placeholder:t,verify:"title"})}),t(i)}})},$uibModal:r,updateData:function(t){n.fragment.fragmentMap({id:e.id,callback:function(a){a.data.id=e.id,t(a)}})},save:function(t,e){var i={};a.each(t,function(t,e){"selects"!=t&&(i[t]=e)}),n.fragment.editFragment({id:e.id,values:JSON.stringify(i),callback:function(t){layui.use(["layer"],function(){layui.layer.msg(t.message),o.reload()})}})},callback:function(t,e){e(t)}})})},del:function(t){l.alert({text:"你确定删除"+t.fragmentName+"吗",btn:["确定","取消"],fn:function(e){n.fragment.delFragment(t)}}),t.callback=function(e){layui.use(["layer"],function(){layui.layer.msg(e.message),0==e.code&&a("table").find("tr[data-id="+t.id+"]").hide()})}},release:function(t){l.alert({text:"确认发布"+t.fragmentName,btn:["确定","取消"],fn:function(e){n.fragment.publish(t)}}),t.callback=function(t){layui.use(["layer"],function(){layui.layer.msg(t.message)})}},filter:["id","fragmentClassifyId"]});var m=1;u(),function(){var t=1;c(function(i){e.searchform={list:i,return:function(){e.searchform.search=null,m=1,t=1,e.$$childHead.current=1,u()},submit:function(i,l){function c(){n.search.searchFragment({condition:i.condition,fragmentClassifyId:r,channelId:d,page:t,pageSize:20,callback:function(a){e.page=a.data.page,e.page.jump=function(e){t!=e.curr&&(t=e.curr,c())},e.searchform.search={count:a.data.page.count,name:i.condition},void 0==a.data.list&&(a.data.list=[]),f(a)}})}var r,d;a.each(i.selects,function(){"fragmentClassifyId"==this.title&&(r=this.id),"channelId"==this.title&&(d=this.id)}),c()}},e.$apply()})}()},link:function(t,e){}}})});