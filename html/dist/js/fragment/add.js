define(["app","./addForm","../data/getData","form","position","fixedNav"],function(app,getList,Data){app.directive("fragmentAdd",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/addAndEdit.html",controller:function($scope,$state){$scope.title="新增碎片",$scope.$parent.menu.push({name:$scope.title}),$scope.save=function(obj,_detail){var channelId,fragmentClassifyId,sortNum;$.each(obj.selects,function(){"channelId"==this.title&&(channelId=this.id),"fragmentClassifyId"==this.title&&(fragmentClassifyId=this.id)}),sortNum||(sortNum=1e3),Data.fragment.createFragment({channelId:channelId,fragmentClassifyId:fragmentClassifyId,fragmentName:obj.fragmentName,fragmentModel:obj.fragmentModel,sortNum:sortNum,callback:function(_data){layui.use(["layer"],function(){layui.layer.msg(_data.message),0==_data.code&&$state.go("fragment.list")})}})},$scope.cancel=function(obj){alert(obj)},getList(function(list){$scope.formdata={title:$scope.title,list:list,submit:[{name:"保存",evt:"save",icon_cls:"save"}]},$scope.$apply()})}}})});