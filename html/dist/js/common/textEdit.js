define(["app","jquery","require","../data/URL","../upload/angular-file-upload/index","wangEditor"],function(app,$,require,URL,uploadify){return{init:function($scope,obj){app.directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",controller:function($scope,$uibModal){$scope.$uibModal=$uibModal},link:function(scope,element,attrs,ngModel){if(ngModel){ngModel.$render=function(){element.html(ngModel.$viewValue||"")},element.on("blur keyup change",function(){});var editor=new wangEditor(element);editor.config.menus=["source","|","bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","table","emotion","|","indent","lineheight","img","location","insertcode","|","undo","redo","fullscreen","stock"],editor.config.menus=$.map(editor.config.menus,function(item,key){return"insertcode"===item?null:"fullscreen"===item?null:"location"==item?null:item});var baseCode,suffix;editor.config.uploadImgFns.prvonload=function(base64,filename){suffix=filename.match(/\w+$/)[0],baseCode=base64,editor.config.uploadParams={suffix:suffix,baseCode:baseCode.split(",")[1]}},editor.config.uploadImgFns.onload=function(resultText,xhr){var originalName=editor.uploadImgOriginalName||"",obj=$.parseJSON(resultText);editor.command(null,"insertHtml",'<img src="'+obj.data.imageUrl+'" alt="'+originalName+'" style="max-width:100%;"/>')},editor.config.uploadImgFns.ontimeout=function(xhr){alert("上传超时")},editor.config.uploadImgFns.onerror=function(xhr){alert("上传错误")},editor.config.uploadImgUrl=URL.upload.uploadImage,editor.config.videoUpload=function(){uploadify.init({data:{obj:{},title:"上传视频",name:"请选择视频",type:"video",success:function(fileItem,response,status,headers){var video="<video src='' width='200' height='200'></video>";editor.command(null,"insertHtml",video)},event:function(file,$uibModalInstance){$scope.imageInfo=file,$uibModalInstance.dismiss("cancel")}},$uibModal:scope.$uibModal})},editor.ready(function(){obj.callback(editor)}),editor.config.jsFilter=!0,editor.config.pasteFilter=!0,editor.config.printLog=!1,editor.create(),$scope.editor=editor,window.Editor=editor,editor.$txt.html("<p>请输入内容</p>")}}}})}}});