define(["app","jquery","./moduls/directive"],function(e,t){e.directive("formList",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/formlist.html",scope:{data:"=data",edit:"=edit",filter:"=filter",searchform:"=searchform",page:"=page"},controller:function(e,l,c,n){layui.link("js/plug/layui/css/layui.css");var i={add:"plus",edit:"pencil",down:"download-alt",upload:"upload-alt",zoom_in:"zoom-in",del:"trash"};e.$watch(function(){return e.data},function(){if(e.data)return t.each(e.data.table.edit,function(e,t){t.icon=i[t.cls]}),void(e.data.table.edit1&&t.each(e.data.table.edit1,function(e,t){t.icon=i[t.cls]}))},!0)},link:function(e,l,c,n){function i(e,l){e.each(function(){var e=t(this).find("input");e.unbind().click(function(e){e.stopPropagation(),l(this.checked)}),t(this).click(function(){e.click()})})}var a,s,o,u=t(l[0]),r=0;e.isSelectAll=!1,e.selectAllIcon=!1,e.$watch("isSelectAll",function(){a&&select&&(1==e.isSelectAll?(e.selectAllIcon=!0,r=s):0==e.isSelectAll?(e.selectAllIcon=!1,r=0):e.selectAllIcon=!1,select.children().each(function(){!0===e.isSelectAll?this.checked=!0:0==e.isSelectAll&&(this.checked=!1)}))}),e.$watch("selectAllIcon",function(){a&&select&&(e.selectAllIcon?(a.children()[0].checked=!0,o&&(o.className="icon-ok-sign")):(a.children()[0].checked=!1,o&&(o.className="icon-ok")))}),angular.extend(e,{thFinish:function(){e.data.table.select&&i(a=u.find("th.select"),function(t){e.selectEdit()})},tdFinish:function(){e.data.table.select&&(select=u.find("td.select"),s=select.length,i(select,function(t){t?r++:r--,e.isSelectAll=r>=s||!(r<=0)&&2,e.$apply()}))},editsFinish:function(){t.each(e.data.table.edit,function(e,t){t.cls})},submit:function(t,l,c){t&&t(l,e,c)}}),e.selectEdit=function(){e.isSelectAll=!0!==e.isSelectAll,"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()},e.selectAll=function(l){o=t(l.currentTarget).find("i")[0],e.selectEdit()},e.getSelect=e.delAll=function(e){var l="";select.children().each(function(){1==this.checked&&(l+=t(this).parent().parent().attr("data-id")+",")}),(l=l.substr(0,l.length-1)).length<1?layui.use(["layer"],function(){layui.layer.msg("请至少选择一项进行操作。",function(){})}):e(l)},e.getOneSelect=function(t){e.getSelect(function(e){e.split(",").length>1?layui.use(["layer"],function(){layui.layer.msg("暂时不支持多个选择。",function(){})}):t(e)})},e.current=1,e.$watch(function(){return e.page},function(){if(e.page&&e.page.pageCount)return layui.use(["laypage","layer"],function(){var t=layui.laypage;layui.layer;t({cont:"pages",pages:e.page.pageCount,groups:5,curr:e.page.page,jump:function(t){e.current=t.curr,e.page.jump(t)}})}),!1},!0)}}})});