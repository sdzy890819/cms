define(["app","jquery","./data/getData","./moduls/directive"],function(app,$,getData){app.directive("menuNav",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/menu.html",compile:function(tEle,tAttrs,transcludeFn){return{pre:function(scope,iElement,iAttrs,controller){getData.permission.currentMenuPermission({callback:function(_data){scope.Nav=_data.data,scope.$apply()}})},post:function(scope,element,iAttrs,controller){scope.$on("columnDone",function(){function getHeight(){var bodyHeight=($("body"),document.body.scrollHeight),menuHeight=element.find(".menubar").height()+70,height=bodyHeight-$("#Header").height();menuHeight<height?element.height(height):element.height(menuHeight)}function clearMenu(num){column.parent().removeClass("open").find(".arrow").removeClass("cur"),column.each(function(i){i!=num&&$(this).removeClass("cur").next().slideUp("fast")})}function showMenu(){var name=state.current.name;submenu.each(function(i){var aName=$(this).attr("ui-sref"),nameAr=name.split("."),len=nameAr.length-1,parent=$(this).parent();parent.removeClass("cur"),aName==name&&($(this).parent().addClass("cur"),$.each(nameAr,function(i){parent=parent.parent(),i==len&&(parent=parent.find(">a"),parent.parent().addClass("open").find(".arrow").addClass("cur"),parent.next().css({display:"block"}),parent[0].parentclas=!1,parent.click())}))})}var state=scope.state,column=(state.current.name,$(element[0]).find(".option >ul >li >a")),submenu=$(element[0]).find(".sub-menu a");$(".sub-menu li a").click(function(){var myhref=$(this).attr("ui-sref"),href=window.location.href.match(/\#[\w|\/]+/);try{href=href[0].replace("#/",""),href=href.replace(/\//g,"."),href==myhref&&location.reload()}catch(e){}}),element=$(element[0]),window.onresize=getHeight,getHeight(),setTimeout(getHeight,1e3),scope.menuClick=function(i,obj,$event){var tag=$event.currentTarget,self=$(tag);clearMenu(i),tag.parentclas?(tag.parentclas=!1,self.parent().removeClass("open"),self.find(".arrow").removeClass("cur"),self.next().slideUp("fast")):(tag.parentclas=!0,self.parent().addClass("open"),self.find(".arrow").addClass("cur"),self.next().slideDown("fast")),setTimeout(getHeight,500)},showMenu();var tabNav=element.find(".webapp-tab li"),option=element.find(".option");tabNav.each(function(i,ele){$(ele).click(function(){tabNav.removeClass("current").eq(i).addClass("current"),option.fadeOut(),option.eq(i).fadeIn()})}),scope.$on("$viewContentLoaded",function(){setTimeout(function(){element.css({height:"auto"}),getHeight(),showMenu()},500)}),function(){var menu=$(".sidebar-menu"),right=$("#Container"),jian=$(".sidebar-menu .jian"),open=!0;jian.click(function(){open=!open,open?(jian.removeClass("cur").html("&lt;"),menu.removeClass("cur"),right.removeClass("cur")):(jian.addClass("cur").html("&gt;"),menu.addClass("cur"),right.addClass("cur"))})}()})}}},controller:function($scope,$state){$scope.state=$state}}})});