define(["app","jquery"],function(app,$){app.factory({GenerateArrList:function(){return{arr:function(oldarr,filter,changeTypeName){var arr=[];return $.each(oldarr,function(i,obj){var li={},k=0,_arr=[];$.each(obj,function(key,val){for(var b=!1,j=0,len=filter.length;j<len;j++)if(key==filter[j]){b=!0;break}if(filter[0].id&&filter[0].id==key&&(li.id=val),b)li[key]=val;else{var newName;changeTypeName&&$.each(changeTypeName,function(k,obj){key==obj.name&&(newName={},newName[obj.newName]=val)}),newName?_arr.push(newName):_arr.push({name:val}),li[key]=val,k++}}),li.list=_arr,arr.push(li)}),arr},setArr:function(list,th){var li=[],showArr=[];return list?($.each(list,function(i,obj){showArr=[],$.each(th,function(_k,_thobj){$.each(obj,function(objkey,objval){var newObj={};objkey==_thobj.key&&(_thobj.changeObjectName&&$.each(_thobj.changeObjectName,function(j,item){obj[item.name]&&(newObj[item.newName]=obj[item.name])}),newObj.name=objval,showArr.push(newObj))})}),obj.list=showArr,li.push(obj)}),li):[]},extendType:function(extend,arr,exclude){function newExtend(k,key,value){$.each(extend,function(){try{this.list[k][key]=value}catch(e){console.log("TH中的操作不在td范围内或者list[k]=null")}})}exclude=exclude||[];var _obj={},len=exclude.length;$.each(arr,function(k,obj){$.each(obj,function(key,value){if(len){for(var bool=!1,i=0;i<len;i++)if(key==exclude[i]){bool=!0;break}bool||(newExtend(k,key,value),_obj[key]=value)}else _obj[key]=value,newExtend(k,key,value)})})},extendChild:function(extend,arr,type){$.each(extend,function(){this.list[type]=arr})},changeTypeName:function(extend,array){$.each(array,function(i,obj){$.each(extend,function(j,_obj){$.each(_obj,function(key,value){key==obj.name&&(_obj[obj.newName]=value)})})})}}},DataService:function($q){return{data:function(fn){var deferred=$q.defer();return fn({callback:function(_data){deferred.resolve(_data)},error:function(reason){deferred.reject(reason)}}),deferred.promise},datas:function(repos){var d=$q.defer(),output=[];return $.each(repos,function(i,fn){fn({callback:function(_data){output.push(_data),d.notify(output)},error:function(reason){d.reject(reason)}})}),d.resolve(output),d.promise}}}})});