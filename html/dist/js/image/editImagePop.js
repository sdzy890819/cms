define(["app","jquery","../upload/index","../data/getData","form"],function(e,a,i,t){return{init:function(e){var n=e.$uibModal,l=e.list;"array"==a.type(l)&&(l=function(a){a(e.list)}),e.$uibModal.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"../template/common/addAndEdit.html",size:"lg",controller:function(o,m,s,d,u){o.data=null,angular.extend(o,{titelement:{close:!0},save:function(a){function i(e){layui.use(["layer"],function(){layui.layer.msg(e,{icon:5})})}var n=e.obj,l="yes"==n.watermark?1:0,s=a.isSize,c=a.selectSize,r=a.imageWidth,g=a.imageHeight,f=a.title,p=n.imageUrl.split(".")[1];if(void 0==o.imageInfo)t.image.updateImages({id:n.id,imageUrl:n.imageUrl,imageTitle:a.title,callback:function(e){layui.use(["layer"],function(){layui.layer.msg(e.message),u.reload(),m.dismiss("cancel")})}});else{p=o.imageInfo.name.match(/\w+$/)[0];d.base64DataUrl(o.imageInfo).then(function(e){e&&("no"==s||"yes"==s&&"yes"==c&&r||"yes"==s&&"no"==c&&g)?t.upload.uploadImage({baseCode:e.split(",")[1],suffix:p,watermark:l,width:r,height:g,callback:function(e){var a=e.data;t.image.updateImages({id:n.id,imageUrl:a.imageUrl,imageWidthPixel:a.imageWidthPixel,imageHeightPixel:a.imageHeightPixel,orgWidthPixel:a.orgWidthPixel,orgHeightPixel:a.orgHeightPixel,imageTitle:f,imagePath:a.imagePath,watermark:a.watermark,compress:a.compress,fid:a.fid,size:a.size,callback:function(e){layui.use(["layer"],function(){layui.layer.msg(e.message),u.reload(),m.dismiss("cancel")})}})}}):e?"yes"!=s||"yes"!=c||r?"yes"!=s||"no"!=c||g||i("请输入高度"):i("请输入高度"):i("请上传图片")})}},cancel:function(a){e.cancel(a,o.data)},close:function(){m.dismiss("cancel")}}),l(function(a){e.callback(a,function(a){o.formdata={title:"编辑",cls:"popedit",list:a,submit:[{name:"确定",evt:"save",icon_cls:"save"}]},e.updateData(function(e){o.data=e.data,o.$$phase||o.$apply()}),o.$$phase||o.$apply()})}),o.$on("formRepeat",function(){a(".layui-upload-button").unbind().click(function(){i.init({data:{obj:{},title:"上传图片",name:"请选择图片",type:"image",event:function(e,i){o.imageInfo=e,console.log(e),d.base64DataUrl(o.imageInfo).then(function(i){var t="<img src='"+e.$ngfDataUrl+"'width='100px' class='thumb'>";a(".imagePre").empty().append(t)}),i.dismiss("cancel")}},$uibModal:n})});var e=a("form.layui-form"),t=(e.find('input[name="isSize"]'),e.find('input[name="selectSize"]').parent().parent()),l=e.find('input[name="imageWidth"]').parent().parent(),m=e.find('input[name="imageHeight"]').parent().parent(),s=!0;m.hide(),layui.use(["form","layedit","laydate"],function(){function e(){0==s?(m.show(),l.hide()):(m.hide(),l.show())}var a=layui.form();layui.layer,layui.layedit,layui.laydate;a.on("radio",function(a){var i=a.elem.name,n=a.value;"isSize"==i?"no"==n?(t.hide(),l.hide(),m.hide()):(t.show(),e()):"selectSize"==i&&(s="no"!=n,e())})})})}})},updateData:function(){}}});