define(["require","app","jquery","search","./searchForm","../data/getData","./addForm",,"formlist","fixedNav","position","../moduls/service","../moduls/factory"],function(e,a,t,i,n,l,r){a.directive("imageList",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/list.html",controller:function(a,i,c,d,m){function o(e){a.page=e.data.page,a.page.jump=function(e){s!=e.curr&&(s=e.curr,u())};var i=[{name:"图片ID",key:"id",width:50},{name:"图片标题",key:"imageTitle",width:180},{name:"图片地址",key:"imageUrl",width:60},{name:"预览图",key:"imageUrl",width:"50"},{name:"图片宽度",key:"imageWidthPixel",width:60},{name:"图片高度",key:"imageHeightPixel",width:60},{name:"创建人",key:"createUserName",width:60},{name:"创建时间",key:"createTimeStr",width:80},{name:"修改人",key:"lastModifyUserName",width:60},{name:"修改时间",key:"updateTimeStr",width:80},{name:"操作",width:"100",class:"center"}];a.listdata={title:a.title,table:{select:!0,th:i,td:m.setArr(e.data.list,i),edit:[{cls:"edit",name:"编辑",evt:a.edit},{cls:"del",name:"删除",evt:a.del}]}},t.each(a.listdata.table.td,function(e,a){a.list[3].image=a.imageUrl,a.list[3].name=!1}),m.extendChild(a.listdata.table.td,a.listdata.table.edit,"edit"),a.$$phase||a.$apply()}function u(){l.image.imageslist({page:s,pageSize:20,callback:o})}a.title="图片列表",a.$parent.menu.push({name:a.title}),angular.extend(a,{add:function(e){i.alert({text:"你的ID为："+e,btn:["确定","取消"],fn:function(e){layer.close(e)}})},edit:function(a){e(["./editImagePop"],function(e){e.init({obj:a,list:r,$uibModal:c,updateData:function(e){var t={};t.imageUrl=a.imageUrl,t.title=a.imageTitle,0==a.watermark?t.watermark="否":t.watermark="是",t.imageWidth=a.imageWidthPixel,t.imageHeight=a.imageHeightPixel,e({data:t})},callback:function(e,a){a(e)}})})},del:function(e){layui.use(["layer"],function(){var a=layui.layer;a.alert("你确定删除："+e.imageTitle,{skin:"layui-layer-molv newBtn",title:"删除",anim:1,btn:["普通删除","物理删除","取消"],shadeClose:!0,yes:function(t){l.image.delImage(e),a.close(t)},btn2:function(t){l.image.delImage({id:e.id,force:1,callback:e.callback}),a.close(t)}})}),e.callback=function(a){layui.use(["layer"],function(){layui.layer.msg(a.message),0==a.code&&t("table").find("tr[data-id="+e.id+"]").hide()})}},filter:["id","uploadUserId"]});var s=1;u(),function(){var e=1;n(function(t){a.searchform={list:t,return:function(){a.searchform.search=null,s=1,e=1,a.$$childHead.current=1,u()},submit:function(t,i){function n(){l.search.searchImages({condition:t.condition,page:e,pageSize:20,callback:function(i){a.page=i.data.page,a.page.jump=function(a){e!=a.curr&&(e=a.curr,n())},a.searchform.search={count:i.data.page.count,name:t.condition},o(i)}})}n()}},a.$$phase||a.$apply()})}()},link:function(e,a){}}})});