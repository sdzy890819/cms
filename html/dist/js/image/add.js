define(["app","./addForm","../upload/index","../data/getData","form","position","fixedNav"],function(e,a,i,t){e.directive("imageAdd",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/addAndEdit.html",controller:function(e,n,l,m){e.title="新增图片",e.$parent.menu.push({name:e.title}),e.data={imageWidth:360},angular.extend(e,{save:function(a){function i(e){layui.use(["layer"],function(){layui.layer.msg(e,{icon:5})})}var l="yes"==a.watermark?1:0,o=a.isSize,r=a.selectSize,d=a.imageWidth,s=a.imageHeight,c=a.title;if(s>0&&(d=0),d>0&&(s=0),!e.imageInfo)return i("请上传图片!");var u=e.imageInfo.name.match(/\w+$/)[0];n.base64DataUrl(e.imageInfo).then(function(e){e&&("no"==o||"yes"==o&&"yes"==r&&d||"yes"==o&&"no"==r&&s)?t.upload.uploadImage({baseCode:e.split(",")[1],suffix:u,watermark:l,width:d,height:s,callback:function(e){var a=e.data;t.image.createImages({imageUrl:a.imageUrl,imageWidthPixel:a.imageWidthPixel,imageHeightPixel:a.imageHeightPixel,orgWidthPixel:a.orgWidthPixel,orgHeightPixel:a.orgHeightPixel,imageTitle:c,imagePath:a.imagePath,watermark:a.watermark,compress:a.compress,fid:a.fid,size:a.size,callback:function(e){layui.use(["layer"],function(){layui.layer.msg(e.message),0==e.code&&m.go("image.list")})}})}}):e?"yes"!=o||"yes"!=r||d?"yes"!=o||"no"!=r||s||i("请输入高度"):i("请输入宽度"):i("请上传图片")})}}),e.$on("formRepeat",function(){$(".layui-upload-button").unbind().click(function(){i.init({data:{obj:{},title:"上传图片",name:"请选择图片",type:"image",event:function(a,i){e.imageInfo=a,n.base64DataUrl(e.imageInfo).then(function(e){var i="<img src='"+a.$ngfDataUrl+"'width='100px' class='thumb'>";$(".imagePre").empty().append(i)}),i.dismiss("cancel")}},$uibModal:l})});var a=$("form.layui-form"),t=(a.find('input[name="isSize"]'),a.find('input[name="selectSize"]').parent().parent()),m=a.find('input[name="imageWidth"]'),o=m.parent().parent(),r=a.find('input[name="imageHeight"]'),d=r.parent().parent(),s=!0;d.hide(),layui.use(["form","layedit","laydate"],function(){function e(){0==s?(d.show(),o.hide(),m.val("")):(d.hide(),o.show(),r.val(""))}var a=layui.form();layui.layer,layui.layedit,layui.laydate;a.on("radio",function(a){var i=a.elem.name,n=a.value;"isSize"==i?"no"==n?(t.hide(),o.hide(),d.hide(),m.val("0"),r.val("0")):(t.show(),e()):"selectSize"==i&&(s="no"!=n,e())})})}),e.formdata={title:e.title,list:a,submit:[{name:"保存",evt:"save",icon_cls:"save"},{name:"取消",evt:"cancel",icon_cls:"cancel",cls:"cancel"}]}}}})});