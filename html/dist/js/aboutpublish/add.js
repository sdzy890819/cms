define(["app","./addForm","../data/getData","../moduls/Tool","form","position","fixedNav"],function(e,a,t,n){e.directive("newsAdd",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/addAndEdit.html",controller:function(e,c){function l(e){$.each(e.selects,function(){"channelId"==this.title&&(o=this.id),"columnId"==this.title&&(s=this.id),"categoryId"==this.title&&(i=this.id)});var a=(new Date).valueOf();if(new Date(e.writeTime).valueOf()<a)return void alert("发布时间必须大于当前时间");t.news.createNews({title:e.title,subTitle:e.subTitle,keyword:e.keyword,description:e.description,source:e.source,author:e.author,channelId:o,columnId:s,categoryId:i,content:e.html,autoPublish:"yes"==e.show?1:0,editPublishTime:e.editPublishTime,timer:e.writeTime,field1:e.field1,field2:e.field2,field3:e.field3,field4:e.field4,field5:e.field5,publish:e.publish,callback:function(e){layui.use(["layer"],function(){layui.layer.msg(e.message),0==e.code&&c.reload()})}})}e.$parent.menu.push({name:"新增新闻"});var i,o,s;angular.extend(e,{rlease:function(e){if(e.html.length<10)return void layui.use("layer",function(){layui.layer.msg("内容不能小于10位数!",{icon:2,anim:6})});e.publish=0,l(e)},draft:function(e){e.publish=2,l(e)}}),a(function(a){$.each(a,function(a,c){"content"==c.title&&(c.width="1100px"),"select"==c.type&&(t.news.previousColumn({callback:function(a){i=a.data.categoryId,o=a.data.channelId,s=a.data.columnId,t.channel.currentChannelList({categoryId:i,callback:function(a){var t=[c.select[1][0]];c.select[1]=t,c.select[1]=c.select[1].concat(n.changeObjectName(a.data,[{name:"channelName",newName:"name"}])),e.$apply()}}),t.news.newscolumnlist({channelId:o,callback:function(a){var t=[c.select[2][0]];c.select[2]=t,c.select[2]=c.select[2].concat(n.changeObjectName(a.data,[{name:"columnName",newName:"name"}])),e.$apply()}}),e.data={categoryId:i,channelId:o,columnId:s,source:a.data.source||""},e.$apply()}}),c.callback=function(a){"categoryId"==a.title?t.channel.currentChannelList({categoryId:a.obj.id,callback:function(t){var l=[c.select[1][0]];c.select[1]=l,c.select[1]=c.select[1].concat(n.changeObjectName(t.data,[{name:"channelName",newName:"name"}])),c.select[2]=[c.select[2][0]],e.$apply(),a.callback()}}):"channelId"==a.title&&t.news.newscolumnlist({channelId:a.obj.id,callback:function(t){var l=[c.select[2][0]];c.select[2]=l,c.select[2]=c.select[2].concat(n.changeObjectName(t.data,[{name:"columnName",newName:"name"}])),e.$apply(),a.callback()}})})}),e.formdata={title:"新增新闻",list:a,submit:[{name:"提交",evt:"rlease",icon_cls:"ok"},{name:"保存草稿",evt:"draft",icon_cls:"view"},{name:"取消",evt:"cancel",icon_cls:"cancel",cls:"cancel"}]},e.$apply()})}}})});