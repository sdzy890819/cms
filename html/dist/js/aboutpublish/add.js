define(["app","./addForm","../data/getData","../moduls/Tool","form","position","fixedNav"],function(e,a,t,c){e.directive("newsAdd",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/addAndEdit.html",controller:function(e,l){function n(e){$.each(e.selects,function(){"channelId"==this.title&&(s=this.id),"columnId"==this.title&&(o=this.id),"categoryId"==this.title&&(i=this.id)});var a=(new Date).valueOf();new Date(e.writeTime).valueOf()<a?alert("发布时间必须大于当前时间"):t.news.createNews({title:e.title,subTitle:e.subTitle,keyword:e.keyword,description:e.description,source:e.source,author:e.author,channelId:s,columnId:o,categoryId:i,content:e.html,autoPublish:"yes"==e.show?1:0,editPublishTime:e.editPublishTime,timer:e.writeTime,field1:e.field1,field2:e.field2,field3:e.field3,field4:e.field4,field5:e.field5,publish:e.publish,callback:function(e){layui.use(["layer"],function(){layui.layer.msg(e.message),0==e.code&&l.reload()})}})}e.$parent.menu.push({name:"新增新闻"});var i,s,o;angular.extend(e,{rlease:function(e){e.html.length<10?layui.use("layer",function(){layui.layer.msg("内容不能小于10位数!",{icon:2,anim:6})}):(e.publish=0,n(e))},draft:function(e){e.publish=2,n(e)}}),a(function(a){$.each(a,function(a,l){"content"==l.title&&(l.width="1100px"),"select"==l.type&&(t.news.previousColumn({callback:function(a){i=a.data.categoryId,s=a.data.channelId,o=a.data.columnId,t.channel.currentChannelList({categoryId:i,callback:function(a){var t=[l.select[1][0]];l.select[1]=t,l.select[1]=l.select[1].concat(c.changeObjectName(a.data,[{name:"channelName",newName:"name"}])),e.$apply()}}),t.news.newscolumnlist({channelId:s,callback:function(a){var t=[l.select[2][0]];l.select[2]=t,l.select[2]=l.select[2].concat(c.changeObjectName(a.data,[{name:"columnName",newName:"name"}])),e.$apply()}}),e.data={categoryId:i,channelId:s,columnId:o,source:a.data.source||""},e.$apply()}}),l.callback=function(a){"categoryId"==a.title?t.channel.currentChannelList({categoryId:a.obj.id,callback:function(t){var n=[l.select[1][0]];l.select[1]=n,l.select[1]=l.select[1].concat(c.changeObjectName(t.data,[{name:"channelName",newName:"name"}])),l.select[2]=[l.select[2][0]],e.$apply(),a.callback()}}):"channelId"==a.title&&t.news.newscolumnlist({channelId:a.obj.id,callback:function(t){var n=[l.select[2][0]];l.select[2]=n,l.select[2]=l.select[2].concat(c.changeObjectName(t.data,[{name:"columnName",newName:"name"}])),e.$apply(),a.callback()}})})}),e.formdata={title:"新增新闻",list:a,submit:[{name:"提交",evt:"rlease",icon_cls:"ok"},{name:"保存草稿",evt:"draft",icon_cls:"view"},{name:"取消",evt:"cancel",icon_cls:"cancel",cls:"cancel"}]},e.$apply()})}}})});