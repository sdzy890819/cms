define(["app","./addForm","../data/getData","../moduls/Tool","form","position","fixedNav"],function(app,getList,getData,Tool){app.directive("topicAdd",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"../template/common/addAndEdit.html",controller:function($scope,$state){$scope.title="新增专题",$scope.$parent.menu.push({name:$scope.title}),$scope.rlease=function(obj){var channelId,topicColumnId,categoryId,topicClassifyId;$.each(obj.selects,function(){"channelId"==this.title&&(channelId=this.id),"topicColumnId"==this.title&&(topicColumnId=this.id),"categoryId"==this.title&&(categoryId=this.id),"topicClassifyId"==this.title&&(topicClassifyId=this.id)}),getData.topic.createTopic({topicTitle:obj.topicTitle,topicContent:obj.topicContent,topicPath:obj.topicPath,topicFilename:obj.topicFilename,topicClassifyId:topicClassifyId,categoryId:categoryId,channelId:channelId,releaseTime:obj.releaseTime,keyword:obj.keyword,description:obj.description,topicColumnId:topicColumnId,callback:function(_data){layui.use(["layer"],function(){var layer=layui.layer;layer.msg(_data.message),0==_data.code&&$state.go("topic.list")})}})},getList(function(list){$.each(list,function(i,obj){"content"==obj.title&&(obj.width="800px"),"select"==obj.type&&(obj.callback=function(_object){"categoryId"==_object.title&&getData.channel.currentChannelList({categoryId:_object.obj.id,callback:function(_data){var arr=[obj.select[1][0]];obj.select[1]=arr,obj.select[1]=obj.select[1].concat(Tool.changeObjectName(_data.data,[{name:"channelName",newName:"name"}])),$scope.$apply(),_object.callback()}})})}),$scope.formdata={title:$scope.title,list:list,submit:[{name:"确认发布",evt:"rlease",icon_cls:"ok"},{name:"清空",evt:"cancel",icon_cls:"cancel",cls:"cancel"}]},$scope.$apply()})}}})});