!function(factory){"function"==typeof window.define?window.define.amd?window.define("wangEditor",["jquery"],factory):window.define.cmd?window.define(function(require,exports,module){return factory}):factory(window.jQuery):"object"==typeof module&&"object"==typeof module.exports?(window.wangEditorCssPath?require(window.wangEditorCssPath):require("../css/wangEditor.css"),module.exports=factory(window.wangEditorJQueryPath?require(window.wangEditorJQueryPath):require("jquery"))):factory(window.jQuery)}(function($){if(!$||!$.fn||!$.fn.jquery)return void alert("在引用wangEditor.js之前，先引用jQuery，否则无法使用 wangEditor");var _e=function(fn){var E=window.wangEditor;E&&fn(E,$)};return function(window,$){if(window.wangEditor)return void alert("一个页面不能重复引用 wangEditor.js 或 wangEditor.min.js ！！！");var E=function(elem){"string"==typeof elem&&(elem="#"+elem);var $elem=$(elem);if(1===$elem.length){var nodeName=$elem[0].nodeName;"TEXTAREA"!==nodeName&&"DIV"!==nodeName||(this.valueNodeName=nodeName.toLowerCase(),this.$valueContainer=$elem,this.$prev=$elem.prev(),this.$parent=$elem.parent(),this.init())}};E.fn=E.prototype,E.$body=$("body"),E.$document=$(document),E.$window=$(window),E.userAgent=navigator.userAgent,E.getComputedStyle=window.getComputedStyle,E.w3cRange="function"==typeof document.createRange,E.hostname=location.hostname.toLowerCase(),E.websiteHost="wangeditor.github.io|www.wangeditor.com|wangeditor.coding.me",E.isOnWebsite=E.websiteHost.indexOf(E.hostname)>=0,E.docsite="http://www.kancloud.cn/wangfupeng/wangeditor2/113961",window.wangEditor=E,E.plugin=function(fn){E._plugins||(E._plugins=[]),"function"==typeof fn&&E._plugins.push(fn)}}(window,$),_e(function(E,$){E.fn.init=function(){this.initDefaultConfig(),this.addEditorContainer(),this.addTxt(),this.addMenuContainer(),this.menus={},this.commandHooks()}}),_e(function(E,$){E.fn.ready=function(fn){this.readyFns||(this.readyFns=[]),this.readyFns.push(fn)},E.fn.readyHeadler=function(){for(var fns=this.readyFns;fns.length;)fns.shift().call(this)},E.fn.updateValue=function(){var editor=this,$valueContainer=editor.$valueContainer,$txt=editor.txt.$txt;if($valueContainer!==$txt){var value=$txt.html();$valueContainer.val(value)}},E.fn.getInitValue=function(){var editor=this,$valueContainer=editor.$valueContainer,currentValue="",nodeName=editor.valueNodeName;return"div"===nodeName?currentValue=$valueContainer.html():"textarea"===nodeName&&(currentValue=$valueContainer.val()),currentValue},E.fn.updateMenuStyle=function(){var menus=this.menus;$.each(menus,function(k,menu){menu.updateSelected()})},E.fn.enableMenusExcept=function(menuIds){this._disabled||(menuIds=menuIds||[],"string"==typeof menuIds&&(menuIds=[menuIds]),$.each(this.menus,function(k,menu){menuIds.indexOf(k)>=0||menu.disabled(!1)}))},E.fn.disableMenusExcept=function(menuIds){this._disabled||(menuIds=menuIds||[],"string"==typeof menuIds&&(menuIds=[menuIds]),$.each(this.menus,function(k,menu){menuIds.indexOf(k)>=0||menu.disabled(!0)}))},E.fn.hideDropPanelAndModal=function(){var menus=this.menus;$.each(menus,function(k,menu){var m=menu.dropPanel||menu.dropList||menu.modal;m&&m.hide&&m.hide()})}}),_e(function(E,$){function emptyFn(){}var ieRange=!E.w3cRange;E.fn.currentRange=function(cr){if(!cr)return this._rangeData;this._rangeData=cr},E.fn.collapseRange=function(range,opt){opt=opt||"end",opt="start"===opt,(range=range||this.currentRange())&&(range.collapse(opt),this.currentRange(range))},E.fn.getRangeText=ieRange?emptyFn:function(range){if(range=range||this.currentRange())return range.toString()},E.fn.getRangeElem=ieRange?emptyFn:function(range){range=range||this.currentRange();var dom=range.commonAncestorContainer;return 1===dom.nodeType?dom:dom.parentNode},E.fn.isRangeEmpty=ieRange?emptyFn:function(range){return!(!(range=range||this.currentRange())||!range.startContainer||range.startContainer!==range.endContainer||range.startOffset!==range.endOffset)},E.fn.saveSelection=ieRange?emptyFn:function(range){var _parentElem,selection,self=this,txt=self.txt.$txt.get(0);range?_parentElem=range.commonAncestorContainer:(selection=document.getSelection(),selection.getRangeAt&&selection.rangeCount&&(range=document.getSelection().getRangeAt(0),_parentElem=range.commonAncestorContainer)),_parentElem&&($.contains(txt,_parentElem)||txt===_parentElem)&&self.currentRange(range)},E.fn.restoreSelection=ieRange?emptyFn:function(range){var selection;if(range=range||this.currentRange())try{selection=document.getSelection(),selection.removeAllRanges(),selection.addRange(range)}catch(ex){E.error("执行 editor.restoreSelection 时，IE可能会有异常，不影响使用")}},E.fn.restoreSelectionByElem=ieRange?emptyFn:function(elem,opt){elem&&(opt=opt||"end",this.setRangeByElem(elem),"start"===opt&&this.collapseRange(this.currentRange(),"start"),"end"===opt&&this.collapseRange(this.currentRange(),"end"),this.restoreSelection())},E.fn.initSelection=ieRange?emptyFn:function(){var editor=this;if(!editor.currentRange()){var $txt=editor.txt.$txt,$firstChild=$txt.children().first();$firstChild.length&&editor.restoreSelectionByElem($firstChild.get(0))}},E.fn.setRangeByElem=ieRange?emptyFn:function(elem){var editor=this,txtElem=editor.txt.$txt.get(0);if(elem&&$.contains(txtElem,elem)){for(var firstTextNode=elem.firstChild;firstTextNode&&3!==firstTextNode.nodeType;)firstTextNode=firstTextNode.firstChild;for(var lastTextNode=elem.lastChild;lastTextNode&&3!==lastTextNode.nodeType;)lastTextNode=lastTextNode.lastChild;var range=document.createRange();firstTextNode&&lastTextNode?(range.setStart(firstTextNode,0),range.setEnd(lastTextNode,lastTextNode.textContent.length)):(range.setStart(elem,0),range.setEnd(elem,0)),editor.saveSelection(range)}}}),_e(function(E,$){E.w3cRange||(E.fn.getRangeText=function(range){if(range=range||this.currentRange())return range.text},E.fn.getRangeElem=function(range){if(range=range||this.currentRange()){var dom=range.parentElement();return 1===dom.nodeType?dom:dom.parentNode}},E.fn.isRangeEmpty=function(range){return!(range=range||this.currentRange())||!range.text},E.fn.saveSelection=function(range){var _parentElem,self=this,txt=self.txt.$txt.get(0);range?_parentElem=range.parentElement():(range=document.selection.createRange(),_parentElem=void 0===range.parentElement?null:range.parentElement()),_parentElem&&($.contains(txt,_parentElem)||txt===_parentElem)&&self.currentRange(range)},E.fn.restoreSelection=function(currentRange){var range,editor=this;if(currentRange=currentRange||editor.currentRange()){range=document.selection.createRange();try{range.setEndPoint("EndToEnd",currentRange)}catch(ex){}if(0===currentRange.text.length)try{range.collapse(!1)}catch(ex){}else range.setEndPoint("StartToStart",currentRange);range.select()}})}),_e(function(E,$){E.fn.commandHooks=function(){var editor=this,commandHooks={};commandHooks.insertHtml=function(html){var targetElem,$elem=$(html),rangeElem=editor.getRangeElem();(targetElem=editor.getLegalTags(rangeElem))&&$(targetElem).after($elem)},editor.commandHooks=commandHooks}}),_e(function(E,$){E.fn.command=function(e,commandName,commandValue,callback){function commandFn(){commandName&&(editor.queryCommandSupported(commandName)?document.execCommand(commandName,!1,commandValue):(hooks=editor.commandHooks,commandName in hooks&&hooks[commandName](commandValue)))}var hooks,editor=this;this.customCommand(e,commandFn,callback)},E.fn.commandForElem=function(elemOpt,e,commandName,commandValue,callback){var selector,check;"string"==typeof elemOpt?selector=elemOpt:(selector=elemOpt.selector,check=elemOpt.check);var rangeElem=this.getRangeElem();rangeElem=this.getSelfOrParentByName(rangeElem,selector,check),rangeElem&&this.setRangeByElem(rangeElem),this.command(e,commandName,commandValue,callback)},E.fn.customCommand=function(e,commandFn,callback){function hidePanelAndModal(){editor.hideDropPanelAndModal()}var editor=this,range=editor.currentRange();if(!range)return void(e&&e.preventDefault());editor.undoRecord(),this.restoreSelection(range),commandFn.call(editor),this.saveSelection(),this.restoreSelection(),callback&&"function"==typeof callback&&callback.call(editor),editor.txt.insertEmptyP(),editor.txt.wrapImgAndText(),editor.updateValue(),editor.updateMenuStyle(),setTimeout(hidePanelAndModal,200),e&&e.preventDefault()},E.fn.queryCommandValue=function(commandName){var result="";try{result=document.queryCommandValue(commandName)}catch(ex){}return result},E.fn.queryCommandState=function(commandName){var result=!1;try{result=document.queryCommandState(commandName)}catch(ex){}return result},E.fn.queryCommandSupported=function(commandName){var result=!1;try{result=document.queryCommandSupported(commandName)}catch(ex){}return result}}),_e(function(E,$){function _matchesSelectorForIE(selector){var elem=this,$elems=$(selector),result=!1;return $elems.each(function(){if(this===elem)return result=!0,!1}),result}var matchesSelector;E.fn.getLegalTags=function(elem){var legalTags=this.config.legalTags;return legalTags?this.getSelfOrParentByName(elem,legalTags):void E.error("配置项中缺少 legalTags 的配置")},E.fn.getSelfOrParentByName=function(elem,selector,check){if(elem&&selector){matchesSelector||(matchesSelector=elem.webkitMatchesSelector||elem.mozMatchesSelector||elem.oMatchesSelector||elem.matchesSelector),matchesSelector||(matchesSelector=_matchesSelectorForIE);for(var txt=this.txt.$txt.get(0);elem&&txt!==elem&&$.contains(txt,elem);){if(matchesSelector.call(elem,selector)){if(!check)return elem;if(check(elem))return elem}elem=elem.parentNode}}}}),_e(function(E,$){function _getRedoList(editor){return null==editor._redoList&&(editor._redoList=[]),editor._redoList}function _getUndoList(editor){return null==editor._undoList&&(editor._undoList=[]),editor._undoList}function _handle(editor,data,type){var val=data.val,html=editor.txt.$txt.html();if(null!=val){if(val===html)return"redo"===type?void editor.redo():"undo"===type?void editor.undo():void 0;editor.txt.$txt.html(val),editor.updateValue(),editor.onchange&&"function"==typeof editor.onchange&&editor.onchange.call(editor)}}E.fn.undoRecord=function(){var editor=this,$txt=editor.txt.$txt,val=$txt.html(),undoList=_getUndoList(editor),redoList=_getRedoList(editor);val!==(undoList.length?undoList[0]:"").val&&(redoList.length&&(redoList=[]),undoList.unshift({range:editor.currentRange(),val:val}),undoList.length>20&&undoList.pop())},E.fn.undo=function(){var editor=this,undoList=_getUndoList(editor),redoList=_getRedoList(editor);if(undoList.length){var data=undoList.shift();redoList.unshift(data),_handle(this,data,"undo")}},E.fn.redo=function(){var editor=this,undoList=_getUndoList(editor),redoList=_getRedoList(editor);if(redoList.length){var data=redoList.shift();undoList.unshift(data),_handle(this,data,"redo")}}}),_e(function(E,$){E.fn.create=function(){var editor=this;E.$body&&0!==E.$body.length||(E.$body=$("body"),E.$document=$(document),E.$window=$(window)),editor.addMenus(),editor.renderMenus(),editor.renderMenuContainer(),editor.renderTxt(),editor.renderEditorContainer(),editor.eventMenus(),editor.eventMenuContainer(),editor.eventTxt(),editor.readyHeadler(),editor.initSelection(),editor.$txt=editor.txt.$txt;var _plugins=E._plugins;_plugins&&_plugins.length&&$.each(_plugins,function(k,val){val.call(editor)})},E.fn.disable=function(){this.txt.$txt.removeAttr("contenteditable"),this.disableMenusExcept(),this._disabled=!0},E.fn.enable=function(){this._disabled=!1,this.txt.$txt.attr("contenteditable","true"),this.enableMenusExcept()},E.fn.destroy=function(){var self=this,$valueContainer=self.$valueContainer,$editorContainer=self.$editorContainer;"div"===self.valueNodeName?($valueContainer.removeAttr("contenteditable"),$editorContainer.after($valueContainer),$editorContainer.hide()):($valueContainer.show(),$editorContainer.hide())},E.fn.undestroy=function(){var self=this,$valueContainer=self.$valueContainer,$editorContainer=self.$editorContainer,$menuContainer=self.menuContainer.$menuContainer;"div"===self.valueNodeName?($valueContainer.attr("contenteditable","true"),$menuContainer.after($valueContainer),$editorContainer.show()):($valueContainer.hide(),$editorContainer.show())},E.fn.clear=function(){var editor=this,$txt=editor.txt.$txt;$txt.html("<p><br></p>"),editor.restoreSelectionByElem($txt.find("p").get(0))}}),_e(function(E,$){var MenuContainer=function(editor){this.editor=editor,this.init()};MenuContainer.fn=MenuContainer.prototype,E.MenuContainer=MenuContainer}),_e(function(E,$){var MenuContainer=E.MenuContainer;MenuContainer.fn.init=function(){var self=this,$menuContainer=$('<div class="wangEditor-menu-container clearfix"></div>');self.$menuContainer=$menuContainer,self.changeShadow()},MenuContainer.fn.changeShadow=function(){var $menuContainer=this.$menuContainer,editor=this.editor,$txt=editor.txt.$txt;$txt.on("scroll",function(){$txt.scrollTop()>10?$menuContainer.addClass("wangEditor-menu-shadow"):$menuContainer.removeClass("wangEditor-menu-shadow")})}}),_e(function(E,$){var MenuContainer=E.MenuContainer;MenuContainer.fn.render=function(){var $menuContainer=this.$menuContainer;this.editor.$editorContainer.append($menuContainer)},MenuContainer.fn.height=function(){return this.$menuContainer.height()},MenuContainer.fn.appendMenu=function(groupIdx,menu){return this._addGroup(groupIdx),this._addOneMenu(menu)},MenuContainer.fn._addGroup=function(groupIdx){var $menuGroup,$menuContainer=this.$menuContainer;this.$currentGroup&&this.currentGroupIdx===groupIdx||($menuGroup=$('<div class="menu-group clearfix"></div>'),$menuContainer.append($menuGroup),this.$currentGroup=$menuGroup,this.currentGroupIdx=groupIdx)},MenuContainer.fn._addOneMenu=function(menu){var $menuNormal=menu.$domNormal,$menuSelected=menu.$domSelected,$menuGroup=this.$currentGroup,$item=$('<div class="menu-item clearfix"></div>');return $menuSelected.hide(),$item.append($menuNormal).append($menuSelected),$menuGroup.append($item),$item}}),_e(function(E,$){var Menu=function(opt){this.editor=opt.editor,this.id=opt.id,this.title=opt.title,this.$domNormal=opt.$domNormal,this.$domSelected=opt.$domSelected||opt.$domNormal,this.commandName=opt.commandName,this.commandValue=opt.commandValue,this.commandNameSelected=opt.commandNameSelected||opt.commandName,this.commandValueSelected=opt.commandValueSelected||opt.commandValue};Menu.fn=Menu.prototype,E.Menu=Menu}),_e(function(E,$){E.Menu.fn.initUI=function(){var editor=this.editor,uiConfig=editor.UI.menus,menuId=this.id,menuUI=uiConfig[menuId];this.$domNormal&&this.$domSelected||(null==menuUI&&(E.warn('editor.UI配置中，没有菜单 "'+menuId+'" 的UI配置，只能取默认值'),menuUI=uiConfig.default),this.$domNormal=$(menuUI.normal),/^\./.test(menuUI.selected)?this.$domSelected=this.$domNormal.clone().addClass(menuUI.selected.slice(1)):this.$domSelected=$(menuUI.selected))}}),_e(function(E,$){var Menu=E.Menu;Menu.fn.render=function(groupIdx){this.initUI();var editor=this.editor,menuContainer=editor.menuContainer,$menuItem=menuContainer.appendMenu(groupIdx,this),onRender=this.onRender;this._renderTip($menuItem),onRender&&"function"==typeof onRender&&onRender.call(this)},Menu.fn._renderTip=function($menuItem){function show(){$tip.show()}function hide(){$tip.hide()}var $tempDiv,self=this,editor=self.editor,title=self.title,$tip=$('<div class="menu-tip"></div>');self.tipWidth||($tempDiv=$('<p style="opacity:0; filter:Alpha(opacity=0); position:absolute;top:-10000px;">'+title+"</p>"),E.$body.append($tempDiv),editor.ready(function(){var titleWidth=$tempDiv.outerWidth()+5,currentWidth=$tip.outerWidth(),currentMarginLeft=parseFloat($tip.css("margin-left"),10);$tempDiv.remove(),$tempDiv=null,$tip.css({width:titleWidth,"margin-left":currentMarginLeft+(currentWidth-titleWidth)/2}),self.tipWidth=titleWidth})),$tip.append(title),$menuItem.append($tip);var timeoutId;$menuItem.find("a").on("mouseenter",function(e){self.active()||self.disabled()||(timeoutId=setTimeout(show,200))}).on("mouseleave",function(e){timeoutId&&clearTimeout(timeoutId),hide()}).on("click",hide)},Menu.fn.bindEvent=function(){var self=this,$domNormal=self.$domNormal,$domSelected=self.$domSelected,clickEvent=self.clickEvent;clickEvent||(clickEvent=function(e){var dropObj=self.dropPanel||self.dropList||self.modal;if(dropObj&&dropObj.show)return void(dropObj.isShowing?dropObj.hide():dropObj.show());var commandName,commandValue,editor=self.editor;self.selected?(commandName=self.commandNameSelected,commandValue=self.commandValueSelected):(commandName=self.commandName,commandValue=self.commandValue),commandName?editor.command(e,commandName,commandValue):(E.warn('菜单 "'+self.id+'" 未定义click事件'),e.preventDefault())});var clickEventSelected=self.clickEventSelected||clickEvent;$domNormal.click(function(e){self.disabled()||(clickEvent.call(self,e),self.updateSelected()),e.preventDefault()}),$domSelected.click(function(e){self.disabled()||(clickEventSelected.call(self,e),self.updateSelected()),e.preventDefault()})},Menu.fn.updateSelected=function(){var self=this,updateSelectedEvent=(self.editor,self.updateSelectedEvent);updateSelectedEvent||(updateSelectedEvent=function(){var self=this,editor=self.editor,commandName=self.commandName,commandValue=self.commandValue;if(commandValue){if(editor.queryCommandValue(commandName).toLowerCase()===commandValue.toLowerCase())return!0}else if(editor.queryCommandState(commandName))return!0;return!1});var result=updateSelectedEvent.call(self);result=!!result,self.changeSelectedState(result)},Menu.fn.changeSelectedState=function(state){var self=this,selected=self.selected;if(null!=state&&"boolean"==typeof state){if(selected===state)return;self.selected=state,state?(self.$domNormal.hide(),self.$domSelected.show()):(self.$domNormal.show(),self.$domSelected.hide())}},Menu.fn.active=function(active){if(null==active)return this._activeState;this._activeState=active},Menu.fn.activeStyle=function(active){var $dom=(this.selected,this.$domNormal),$domSelected=this.$domSelected;active?($dom.addClass("active"),$domSelected.addClass("active")):($dom.removeClass("active"),$domSelected.removeClass("active")),this.active(active)},Menu.fn.disabled=function(opt){if(null==opt)return!!this._disabled;if(this._disabled!==opt){var $dom=this.$domNormal,$domSelected=this.$domSelected;opt?($dom.addClass("disable"),$domSelected.addClass("disable")):($dom.removeClass("disable"),$domSelected.removeClass("disable")),this._disabled=opt}}}),_e(function(E,$){var DropList=function(editor,menu,opt){this.editor=editor,this.menu=menu,this.data=opt.data,this.tpl=opt.tpl,this.selectorForELemCommand=opt.selectorForELemCommand,this.beforeEvent=opt.beforeEvent,this.afterEvent=opt.afterEvent,this.init()};DropList.fn=DropList.prototype,E.DropList=DropList}),_e(function(E,$){var DropList=E.DropList;DropList.fn.init=function(){var self=this;self.initDOM(),self.bindEvent(),self.initHideEvent()},DropList.fn.initDOM=function(){var itemContent,$item,self=this,data=self.data,tpl=self.tpl||"<span>{#title}</span>",$list=$('<div class="wangEditor-drop-list clearfix"></div>');$.each(data,function(commandValue,title){itemContent=tpl.replace(/{#commandValue}/gi,commandValue).replace(/{#title}/gi,title),$item=$('<a href="#" commandValue="'+commandValue+'"></a>'),$item.append(itemContent),$list.append($item)}),self.$list=$list},DropList.fn.bindEvent=function(){var self=this,editor=self.editor,menu=self.menu,commandName=menu.commandName,selectorForELemCommand=self.selectorForELemCommand,$list=self.$list,beforeEvent=self.beforeEvent,afterEvent=self.afterEvent;$list.on("click","a[commandValue]",function(e){beforeEvent&&"function"==typeof beforeEvent&&beforeEvent.call(e);var commandValue=$(e.currentTarget).attr("commandValue");menu.selected&&editor.isRangeEmpty()&&selectorForELemCommand?editor.commandForElem(selectorForELemCommand,e,commandName,commandValue):editor.command(e,commandName,commandValue),afterEvent&&"function"==typeof afterEvent&&afterEvent.call(e)})},DropList.fn.initHideEvent=function(){var self=this,thisList=self.$list.get(0);E.$body.on("click",function(e){if(self.isShowing){var menuDom,trigger=e.target,menu=self.menu;menuDom=menu.selected?menu.$domSelected.get(0):menu.$domNormal.get(0),menuDom===trigger||$.contains(menuDom,trigger)||thisList===trigger||$.contains(thisList,trigger)||self.hide()}}),E.$window.scroll(function(){self.hide()}),E.$window.on("resize",function(){self.hide()})}}),_e(function(E,$){var DropList=E.DropList;DropList.fn._render=function(){var self=this,editor=self.editor,$list=self.$list;editor.$editorContainer.append($list),self.rendered=!0},DropList.fn._position=function(){var self=this,$list=self.$list,editor=self.editor,menu=self.menu,$menuContainer=editor.menuContainer.$menuContainer,$menuDom=menu.selected?menu.$domSelected:menu.$domNormal,menuPosition=$menuDom.offsetParent().position(),menuTop=menuPosition.top,menuLeft=menuPosition.left,menuHeight=$menuDom.offsetParent().height(),menuWidth=$menuDom.offsetParent().width(),listWidth=$list.outerWidth(),txtWidth=editor.txt.$txt.outerWidth(),top=menuTop+menuHeight,left=menuLeft+menuWidth/2,marginLeft=0-menuWidth/2,valWithTxt=left+listWidth-txtWidth;valWithTxt>-10&&(marginLeft=marginLeft-valWithTxt-10),$list.css({top:top,left:left,"margin-left":marginLeft}),editor._isMenufixed&&(top+=$menuContainer.offset().top+$menuContainer.outerHeight()-$list.offset().top,$list.css({top:top}))},DropList.fn.show=function(){var self=this,menu=self.menu;if(self.rendered||self._render(),!self.isShowing){self.$list.show(),self._position(),self.isShowing=!0,menu.activeStyle(!0)}},DropList.fn.hide=function(){var self=this,menu=self.menu;if(self.isShowing){self.$list.hide(),self.isShowing=!1,menu.activeStyle(!1)}}}),_e(function(E,$){var DropPanel=function(editor,menu,opt){this.editor=editor,this.menu=menu,this.$content=opt.$content,this.width=opt.width||200,this.height=opt.height,this.onRender=opt.onRender,this.init()};DropPanel.fn=DropPanel.prototype,E.DropPanel=DropPanel}),_e(function(E,$){var DropPanel=E.DropPanel;DropPanel.fn.init=function(){var self=this;self.initDOM(),self.initHideEvent()},DropPanel.fn.initDOM=function(){var self=this,$content=self.$content,width=self.width,height=self.height,$panel=$('<div class="wangEditor-drop-panel clearfix"></div>'),$triangle=$('<div class="tip-triangle"></div>');$panel.css({width:width,height:height||"auto"}),$panel.append($triangle),$panel.append($content),self.$panel=$panel,self.$triangle=$triangle},DropPanel.fn.initHideEvent=function(){var self=this,thisPanle=self.$panel.get(0);E.$body.on("click",function(e){if(self.isShowing){var menuDom,trigger=e.target,menu=self.menu;menuDom=menu.selected?menu.$domSelected.get(0):menu.$domNormal.get(0),menuDom===trigger||$.contains(menuDom,trigger)||thisPanle===trigger||$.contains(thisPanle,trigger)||self.hide()}}),E.$window.scroll(function(e){self.hide()}),E.$window.on("resize",function(){self.hide()})}}),_e(function(E,$){var DropPanel=E.DropPanel;DropPanel.fn._render=function(){var self=this,onRender=self.onRender,editor=self.editor,$panel=self.$panel;editor.$editorContainer.append($panel),onRender&&onRender.call(self),self.rendered=!0},DropPanel.fn._position=function(){var self=this,$panel=self.$panel,$triangle=self.$triangle,editor=self.editor,$menuContainer=editor.menuContainer.$menuContainer,menu=self.menu,$menuDom=menu.selected?menu.$domSelected:menu.$domNormal,menuPosition=$menuDom.offsetParent().position(),menuTop=menuPosition.top,menuLeft=menuPosition.left,menuHeight=$menuDom.offsetParent().height(),menuWidth=$menuDom.offsetParent().width(),panelWidth=$panel.outerWidth(),txtWidth=editor.txt.$txt.outerWidth(),top=menuTop+menuHeight,left=menuLeft+menuWidth/2,marginLeft=0-panelWidth/2,marginLeft2=marginLeft;0-marginLeft>left-10&&(marginLeft=0-(left-10));var valWithTxt=left+panelWidth+marginLeft-txtWidth;valWithTxt>-10&&(marginLeft=marginLeft-valWithTxt-10),$panel.css({top:top,left:left,"margin-left":marginLeft}),editor._isMenufixed&&(top+=$menuContainer.offset().top+$menuContainer.outerHeight()-$panel.offset().top,$panel.css({top:top})),$triangle.css({"margin-left":marginLeft2-marginLeft-5})},DropPanel.fn.focusFirstInput=function(){this.$panel.find("input[type=text],textarea").each(function(){var $input=$(this);if(null==$input.attr("disabled"))return $input.focus(),!1})},DropPanel.fn.show=function(){var self=this,menu=self.menu;if(self.rendered||self._render(),!self.isShowing){var $panel=self.$panel;$panel.show(),self._position(),self.isShowing=!0,menu.activeStyle(!0),E.w3cRange?self.focusFirstInput():E.placeholderForIE8($panel)}},DropPanel.fn.hide=function(){var self=this,menu=self.menu;if(self.isShowing){self.$panel.hide(),self.isShowing=!1,menu.activeStyle(!1)}}}),_e(function(E,$){var Modal=function(editor,menu,opt){this.editor=editor,this.menu=menu,this.$content=opt.$content,this.init()};Modal.fn=Modal.prototype,E.Modal=Modal}),_e(function(E,$){var Modal=E.Modal;Modal.fn.init=function(){var self=this;self.initDom(),self.initHideEvent()},Modal.fn.initDom=function(){var self=this,$content=self.$content,$modal=$('<div class="wangEditor-modal"></div>'),$close=$('<div class="wangEditor-modal-close"><i class="wangeditor-menu-img-cancel-circle"></i></div>');$modal.append($close),$modal.append($content),self.$modal=$modal,self.$close=$close},Modal.fn.initHideEvent=function(){var self=this,$close=self.$close,modal=self.$modal.get(0);$close.click(function(){self.hide()}),E.$body.on("click",function(e){if(self.isShowing){var menuDom,trigger=e.target,menu=self.menu;menu&&((menuDom=menu.selected?menu.$domSelected.get(0):menu.$domNormal.get(0))===trigger||$.contains(menuDom,trigger))||modal===trigger||$.contains(modal,trigger)||self.hide()}})}}),_e(function(E,$){var Modal=E.Modal;Modal.fn._render=function(){var self=this,editor=self.editor,$modal=self.$modal;$modal.css("z-index",editor.config.zindex+10+""),E.$body.append($modal),self.rendered=!0},Modal.fn._position=function(){var self=this,$modal=self.$modal,top=$modal.offset().top,width=$modal.outerWidth(),height=$modal.outerHeight(),marginLeft=0-width/2,marginTop=0-height/2,sTop=E.$window.scrollTop();height/2>top&&(marginTop=0-top),$modal.css({"margin-left":marginLeft+"px","margin-top":marginTop+sTop+"px"})},Modal.fn.show=function(){var self=this,menu=self.menu;if(self.rendered||self._render(),!self.isShowing){self.isShowing=!0;self.$modal.show(),self._position(),menu&&menu.activeStyle(!0)}},Modal.fn.hide=function(){var self=this,menu=self.menu;if(self.isShowing){self.isShowing=!1;self.$modal.hide(),menu&&menu.activeStyle(!1)}}}),_e(function(E,$){var Txt=function(editor){this.editor=editor,this.init()};Txt.fn=Txt.prototype,E.Txt=Txt}),_e(function(E,$){var Txt=E.Txt;Txt.fn.init=function(){var $txt,self=this,editor=self.editor,$valueContainer=editor.$valueContainer,currentValue=editor.getInitValue();"DIV"===$valueContainer.get(0).nodeName?($txt=$valueContainer,$txt.addClass("wangEditor-txt"),$txt.attr("contentEditable","true")):$txt=$('<div class="wangEditor-txt" contentEditable="true">'+currentValue+"</div>"),editor.ready(function(){self.insertEmptyP()}),self.$txt=$txt,self.contentEmptyHandle(),self.bindEnterForDiv(),self.bindEnterForText(),self.bindTabEvent(),self.bindPasteFilter(),self.bindFormatText(),self.bindHtml()},Txt.fn.contentEmptyHandle=function(){var $p,self=this,editor=self.editor,$txt=self.$txt;$txt.on("keydown",function(e){if(8===e.keyCode){return"<p><br></p>"===$.trim($txt.html().toLowerCase())?void e.preventDefault():void 0}}),$txt.on("keyup",function(e){if(8===e.keyCode){var txtHtml=$.trim($txt.html().toLowerCase());txtHtml&&"<br>"!==txtHtml||($p=$("<p><br/></p>"),$txt.html(""),$txt.append($p),editor.restoreSelectionByElem($p.get(0)))}})},Txt.fn.bindEnterForDiv=function(){function divHandler(){if($keydownDivElem){var $pElem=$("<p>"+$keydownDivElem.html()+"</p>");$keydownDivElem.after($pElem),$keydownDivElem.remove()}}var $keydownDivElem,self=(E.config.legalTags,this),editor=self.editor,$txt=self.$txt;$txt.on("keydown keyup",function(e){if(13===e.keyCode){var $targetElem,$pElem,rangeElem=editor.getRangeElem(),targetElem=editor.getLegalTags(rangeElem);if(!targetElem){if(!(targetElem=editor.getSelfOrParentByName(rangeElem,"div")))return;$targetElem=$(targetElem),"keydown"===e.type&&($keydownDivElem=$targetElem,setTimeout(divHandler,0)),"keyup"===e.type&&($pElem=$("<p>"+$targetElem.html()+"</p>"),$targetElem.after($pElem),$targetElem.remove(),editor.restoreSelectionByElem($pElem.get(0),"start"))}}})},Txt.fn.bindEnterForText=function(){var handle,self=this,$txt=self.$txt;$txt.on("keyup",function(e){13===e.keyCode&&(handle||(handle=function(){self.wrapImgAndText()}),setTimeout(handle))})},Txt.fn.bindTabEvent=function(){var self=this,editor=self.editor;self.$txt.on("keydown",function(e){9===e.keyCode&&editor.queryCommandSupported("insertHtml")&&editor.command(e,"insertHtml","&nbsp;&nbsp;&nbsp;&nbsp;")})},Txt.fn.bindPasteFilter=function(){function handle(elem){if(elem&&elem.nodeType&&elem.nodeName){var $elem,childNodesClone,nodeName=elem.nodeName.toLowerCase(),nodeType=elem.nodeType;if(3===nodeType||1===nodeType){if($elem=$(elem),"div"===nodeName)return childNodesClone=[],$.each(elem.childNodes,function(index,item){childNodesClone.push(item)}),void $.each(childNodesClone,function(){handle(this)});if(legalTagArr.indexOf(nodeName)>=0)resultHtml+=getResult(elem);else if(3===nodeType)resultHtml+="<p>"+elem.textContent+"</p>";else if("br"===nodeName)resultHtml+="<br/>";else{if(["meta","style","script","object","form","iframe","hr"].indexOf(nodeName)>=0)return;$elem=$(removeAttrs(elem)),resultHtml+=$("<div>").append($elem.clone()).html()}}}}function getResult(elem){var $elem,nodeName=elem.nodeName.toLowerCase(),htmlForP="",htmlForLi="";return["blockquote"].indexOf(nodeName)>=0?($elem=$(elem),"<"+nodeName+">"+$elem.text()+"</"+nodeName+">"):["p","h1","h2","h3","h4","h5"].indexOf(nodeName)>=0?(elem=removeAttrs(elem),$elem=$(elem),htmlForP=$elem.html(),htmlForP=htmlForP.replace(/<.*?>/gi,function(tag){return"</a>"===tag||0===tag.indexOf("<a ")||0===tag.indexOf("<img ")?tag:""}),"<"+nodeName+">"+htmlForP+"</"+nodeName+">"):["ul","ol"].indexOf(nodeName)>=0?($elem=$(elem),$elem.children().each(function(){var $li=$(removeAttrs(this)),html=$li.html();html=html.replace(/<.*?>/gi,function(tag){return"</a>"===tag||0===tag.indexOf("<a ")||0===tag.indexOf("<img ")?tag:""}),htmlForLi+="<li>"+html+"</li>"}),"<"+nodeName+">"+htmlForLi+"</"+nodeName+">"):($elem=$(removeAttrs(elem)),$("<div>").append($elem).html())}function removeAttrs(elem){var attrs=elem.attributes||[],attrNames=[],exception=["href","target","src","alt","rowspan","colspan"];$.each(attrs,function(key,attr){attr&&2===attr.nodeType&&attrNames.push(attr.nodeName)}),$.each(attrNames,function(key,attr){exception.indexOf(attr)<0&&elem.removeAttribute(attr)});var children=elem.childNodes;return children.length&&$.each(children,function(key,value){removeAttrs(value)}),elem}var self=this,editor=self.editor,resultHtml="",$txt=self.$txt,legalTags=editor.config.legalTags,legalTagArr=legalTags.split(",");$txt.on("paste",function(e){if(editor.config.pasteFilter){var currentNodeName=editor.getRangeElem().nodeName;if("TD"!==currentNodeName&&"TH"!==currentNodeName){resultHtml="";var pasteHtml,$paste,data=e.clipboardData||e.originalEvent.clipboardData,ieData=window.clipboardData;if(editor.config.pasteText){if(data&&data.getData)pasteHtml=data.getData("text/plain");else{if(!ieData||!ieData.getData)return;pasteHtml=ieData.getData("text")}pasteHtml&&(resultHtml="<p>"+pasteHtml+"</p>")}else if(data&&data.getData)pasteHtml=data.getData("text/html"),pasteHtml?($paste=$("<div>"+pasteHtml+"</div>"),handle($paste.get(0))):(pasteHtml=data.getData("text/plain"))&&(pasteHtml=pasteHtml.replace(/[ ]/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"</p><p>"),resultHtml="<p>"+pasteHtml+"</p>",resultHtml=resultHtml.replace(/<p>(https?:\/\/.*?)<\/p>/gi,function(match,link){return'<p><a href="'+link+'" target="_blank">'+link+"</p>"}));else{if(!ieData||!ieData.getData)return;if(!(resultHtml=ieData.getData("text")))return;resultHtml="<p>"+resultHtml+"</p>",
resultHtml=resultHtml.replace(new RegExp("\n","g"),"</p><p>")}resultHtml&&(editor.command(e,"insertHtml",resultHtml),self.clearEmptyOrNestP())}}})},Txt.fn.bindFormatText=function(){var self=this,$txt=(self.editor,self.$txt),legalTags=E.config.legalTags,legalTagArr=legalTags.split(","),regArr=(legalTagArr.length,[]);$.each(legalTagArr,function(k,tag){var reg=">\\s*<("+tag+")>";regArr.push(new RegExp(reg,"ig"))}),regArr.push(new RegExp(">\\s*<(li)>","ig")),regArr.push(new RegExp(">\\s*<(tr)>","ig")),regArr.push(new RegExp(">\\s*<(code)>","ig")),$txt.formatText=function(){var $temp=$("<div>"),html=$txt.html();return html=html.replace(/\s*</gi,"<"),$.each(regArr,function(k,reg){reg.test(html)&&(html=html.replace(reg,function(matchStr,tag){return">\n<"+tag+">"}))}),$temp.html(html),$temp.text()}},Txt.fn.bindHtml=function(){var self=this,editor=self.editor,$txt=self.$txt,$valueContainer=editor.$valueContainer,valueNodeName=editor.valueNodeName;$txt.html=function(html){var result;if("div"===valueNodeName&&(result=$.fn.html.call($txt,html)),void 0===html?(result=$.fn.html.call($txt),result=result.replace(/(href|src)\=\"(.*)\"/gim,function(a,b,c){return b+'="'+c.replace("&amp;","&")+'"'})):(result=$.fn.html.call($txt,html),$valueContainer.val(html)),void 0===html)return result;$txt.change()}}}),_e(function(E,$){var Txt=E.Txt,txtChangeEventNames="propertychange change click keyup input paste";Txt.fn.render=function(){var $txt=this.$txt;this.editor.$editorContainer.append($txt)},Txt.fn.initHeight=function(){var editor=this.editor,$txt=this.$txt,valueContainerHeight=editor.$valueContainer.height(),menuHeight=editor.menuContainer.height(),txtHeight=valueContainerHeight-menuHeight;txtHeight=txtHeight<50?50:txtHeight,$txt.height(txtHeight),editor.valueContainerHeight=valueContainerHeight,this.initMaxHeight(txtHeight,menuHeight)},Txt.fn.initMaxHeight=function(txtHeight,menuHeight){var editor=this.editor,$menuContainer=editor.menuContainer.$menuContainer,$txt=this.$txt,$wrap=$("<div>");if(window.getComputedStyle&&"max-height"in window.getComputedStyle($txt.get(0))){var maxHeight=parseInt(editor.$valueContainer.css("max-height"));if(isNaN(maxHeight))return;if(editor.menus.fullscreen)return void E.warn("max-height和『全屏』菜单一起使用时，会有一些问题尚未解决，请暂时不要两个同时使用");editor.useMaxHeight=!0,$wrap.css({"max-height":maxHeight-menuHeight+"px","overflow-y":"auto"}),$txt.css({height:"auto","overflow-y":"visible","min-height":txtHeight+"px"}),$wrap.on("scroll",function(){$txt.parent().scrollTop()>10?$menuContainer.addClass("wangEditor-menu-shadow"):$menuContainer.removeClass("wangEditor-menu-shadow")}),$txt.wrap($wrap)}},Txt.fn.saveSelectionEvent=function(){function save(){editor.saveSelection()}function saveSync(){Date.now()-dt<100||(dt=Date.now(),save())}function saveAync(){timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(save,300)}var timeoutId,$txt=this.$txt,editor=this.editor,dt=Date.now();$txt.on(txtChangeEventNames+" focus blur",function(e){saveSync(),saveAync()}),$txt.on("mousedown",function(){$txt.on("mouseleave.saveSelection",function(e){saveSync(),saveAync(),editor.updateMenuStyle()})}).on("mouseup",function(){$txt.off("mouseleave.saveSelection")})},Txt.fn.updateValueEvent=function(){function doOnchange(){var val=$txt.html();oldValue!==val&&(editor.onchange&&"function"==typeof editor.onchange&&editor.onchange.call(editor),editor.updateValue(),oldValue=val)}var timeoutId,oldValue,$txt=this.$txt,editor=this.editor;$txt.on(txtChangeEventNames,function(e){null==oldValue&&(oldValue=$txt.html()),timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(doOnchange,100)})},Txt.fn.updateMenuStyleEvent=function(){var $txt=this.$txt,editor=this.editor;$txt.on(txtChangeEventNames,function(e){editor.updateMenuStyle()})},Txt.fn.insertEmptyP=function(){var $txt=this.$txt,$children=$txt.children();if(0===$children.length)return void $txt.append($("<p><br></p>"));"<br>"!==$.trim($children.last().html()).toLowerCase()&&$txt.append($("<p><br></p>"))},Txt.fn.wrapImgAndText=function(){var i,childNode,$txt=this.$txt,$imgs=$txt.children("img"),txt=$txt[0],childNodes=txt.childNodes,childrenLength=childNodes.length;for($imgs.length&&$imgs.each(function(){$(this).wrap("<p>")}),i=0;i<childrenLength;i++)childNode=childNodes[i],3===childNode.nodeType&&childNode.textContent&&$.trim(childNode.textContent)&&$(childNode).wrap("<p>")},Txt.fn.clearEmptyOrNestP=function(){this.$txt.find("p").each(function(){var $firstChild,$p=$(this),$children=$p.children(),childrenLength=$children.length;if(!$.trim($p.html()))return void $p.remove();1===childrenLength&&($firstChild=$children.first(),$firstChild.get(0)&&"P"===$firstChild.get(0).nodeName&&$p.html($firstChild.html()))})},Txt.fn.scrollTop=function(val){var self=this,editor=self.editor,$txt=self.$txt;return editor.useMaxHeight?$txt.parent().scrollTop(val):$txt.scrollTop(val)},Txt.fn.showHeightOnHover=function(){function addAndShowTip($target){isTipInTxt||($editorContainer.append($tip),isTipInTxt=!0);var height=($txt.position().top,$txt.outerHeight(),$target.height()),top=$target.position().top,marginTop=parseInt($target.css("margin-top"),10),paddingTop=parseInt($target.css("padding-top"),10),marginBottom=parseInt($target.css("margin-bottom"),10),paddingBottom=parseInt($target.css("padding-bottom"),10);menuContainer.height();$tip.css({height:height+paddingTop+marginTop+paddingBottom+marginBottom,top:top+menuContainer.height()})}function removeTip(){isTipInTxt&&($tip.remove(),isTipInTxt=!1)}var editor=this.editor,$editorContainer=editor.$editorContainer,menuContainer=editor.menuContainer,$txt=this.$txt,$tip=$('<i class="height-tip"><i>'),isTipInTxt=!1;$txt.on("mouseenter","ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre",function(e){addAndShowTip($(e.currentTarget))}).on("mouseleave",function(){removeTip()})}}),_e(function(E,$){Array.prototype.indexOf||(Array.prototype.indexOf=function(elem){for(var i=0,length=this.length;i<length;i++)if(this[i]===elem)return i;return-1},Array.prototype.lastIndexOf=function(elem){var length=this.length;for(length-=1;length>=0;length--)if(this[length]===elem)return length;return-1}),Date.now||(Date.now=function(){return(new Date).valueOf()});var console=window.console,emptyFn=function(){};$.each(["info","log","warn","error"],function(key,value){E[value]=null==console?emptyFn:function(info){E.config&&E.config.printLog&&console[value]("wangEditor提示: "+info)}}),E.random=function(){return Math.random().toString().slice(2)},E.placeholder="placeholder"in document.createElement("input"),E.placeholderForIE8=function($container){E.placeholder||$container.find("input[placeholder]").each(function(){var $input=$(this),placeholder=$input.attr("placeholder");""===$input.val()&&($input.css("color","#666"),$input.val(placeholder),$input.on("focus.placeholder click.placeholder",function(){$input.val(""),$input.css("color","#333"),$input.off("focus.placeholder click.placeholder")}))})}}),_e(function(E,$){E.langs={},E.langs["zh-cn"]={bold:"粗体",underline:"下划线",italic:"斜体",forecolor:"文字颜色",bgcolor:"背景色",strikethrough:"删除线",eraser:"清空格式",source:"源码",quote:"引用",fontfamily:"字体",fontsize:"字号",head:"标题",orderlist:"有序列表",unorderlist:"无序列表",alignleft:"左对齐",aligncenter:"居中",alignright:"右对齐",link:"链接",text:"文本",submit:"提交",cancel:"取消",unlink:"取消链接",table:"表格",emotion:"表情",img:"图片",video:"视频",width:"宽",height:"高",location:"位置",loading:"加载中",searchlocation:"搜索位置",dynamicMap:"动态地图",clearLocation:"清除位置",langDynamicOneLocation:"动态地图只能显示一个位置",insertcode:"插入代码",undo:"撤销",redo:"重复",fullscreen:"全屏",openLink:"打开链接"},E.langs.en={bold:"Bold",underline:"Underline",italic:"Italic",forecolor:"Color",bgcolor:"Backcolor",strikethrough:"Strikethrough",eraser:"Eraser",source:"Codeview",quote:"Quote",fontfamily:"Font family",fontsize:"Font size",head:"Head",orderlist:"Ordered list",unorderlist:"Unordered list",alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",link:"Insert link",text:"Text",submit:"Submit",cancel:"Cancel",unlink:"Unlink",table:"Table",emotion:"Emotions",img:"Image",video:"Video",width:"width",height:"height",location:"Location",loading:"Loading",searchlocation:"search",dynamicMap:"Dynamic",clearLocation:"Clear",langDynamicOneLocation:"Only one location in dynamic map",insertcode:"Insert Code",undo:"Undo",redo:"Redo",fullscreen:"Full screnn",openLink:"open link"}}),_e(function(E,$){E.config={},E.config.zindex=1e4,E.config.printLog=!0,E.config.menuFixed=0,E.config.jsFilter=!0,E.config.legalTags="p,h1,h2,h3,h4,h5,h6,blockquote,table,ul,ol,pre",E.config.lang=E.langs["zh-cn"],E.config.menus=["source","|","bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","table","emotion","|","img","video","location","insertcode","|","undo","redo","fullscreen"],E.config.colors={"#880000":"暗红色","#800080":"紫色","#ff0000":"红色","#ff00ff":"鲜粉色","#000080":"深蓝色","#0000ff":"蓝色","#00ffff":"湖蓝色","#008080":"蓝绿色","#008000":"绿色","#808000":"橄榄色","#00ff00":"浅绿色","#ffcc00":"橙黄色","#808080":"灰色","#c0c0c0":"银色","#000000":"黑色","#ffffff":"白色"},E.config.familys=["宋体","黑体","楷体","微软雅黑","Arial","Verdana","Georgia","Times New Roman","Microsoft JhengHei","Trebuchet MS","Courier New","Impact","Comic Sans MS","Consolas"],E.config.fontsizes={1:"12px",2:"13px",3:"16px",4:"18px",5:"24px",6:"32px",7:"48px"},E.config.emotionsShow="icon",E.config.emotions={weibo:{title:"微博表情",data:[{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif",value:"[草泥马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif",value:"[神马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif",value:"[浮云]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif",value:"[给力]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif",value:"[围观]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif",value:"[威武]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/panda_thumb.gif",value:"[熊猫]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/81/rabbit_thumb.gif",value:"[兔子]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/otm_thumb.gif",value:"[奥特曼]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/15/j_thumb.gif",value:"[囧]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/hufen_thumb.gif",value:"[互粉]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c4/liwu_thumb.gif",value:"[礼物]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ac/smilea_thumb.gif",value:"[呵呵]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0b/tootha_thumb.gif",value:"[哈哈]"}]}},E.config.mapAk="TVhjYjq1ICT2qqL5LdS8mwas",E.config.uploadImgUrl="",E.config.uploadTimeout=2e4,E.config.uploadImgFns={},E.config.customUpload=!1,E.config.uploadParams={},E.config.uploadHeaders={},E.config.hideLinkImg=!1,E.config.pasteFilter=!0,E.config.pasteText=!1,E.config.codeDefaultLang="javascript"}),_e(function(E,$){E.UI={},E.UI.menus={default:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-command"></i></a>',selected:".selected"},bold:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-bold"></i></a>',selected:".selected"},underline:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-underline"></i></a>',selected:".selected"},italic:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-italic"></i></a>',selected:".selected"},forecolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-pencil"></i></a>',selected:".selected"},bgcolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-brush"></i></a>',selected:".selected"},strikethrough:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-strikethrough"></i></a>',selected:".selected"},eraser:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-eraser"></i></a>',selected:".selected"},quote:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-quotes-left"></i></a>',selected:".selected"},source:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-code"></i></a>',selected:".selected"},fontfamily:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-font2"></i></a>',selected:".selected"},fontsize:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-text-height"></i></a>',selected:".selected"},head:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-header"></i></a>',selected:".selected"},orderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-numbered"></i></a>',selected:".selected"},unorderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-bullet"></i></a>',selected:".selected"},alignleft:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-left"></i></a>',selected:".selected"},aligncenter:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-center"></i></a>',selected:".selected"},alignright:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-right"></i></a>',selected:".selected"},link:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-link"></i></a>',selected:".selected"},unlink:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-unlink"></i></a>',selected:".selected"},table:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-table"></i></a>',selected:".selected"},emotion:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-happy"></i></a>',selected:".selected"},img:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-picture"></i></a>',selected:".selected"},video:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-play"></i></a>',selected:".selected"},location:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-location"></i></a>',selected:".selected"},insertcode:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-terminal"></i></a>',selected:".selected"},undo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-ccw"></i></a>',selected:".selected"},redo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-cw"></i></a>',selected:".selected"},fullscreen:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-enlarge2"></i></a>',selected:'<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-shrink2"></i></a>'}}}),_e(function(E,$){E.fn.initDefaultConfig=function(){var editor=this;editor.config=$.extend({},E.config),editor.UI=$.extend({},E.UI)}}),_e(function(E,$){E.fn.addEditorContainer=function(){this.$editorContainer=$('<div class="wangEditor-container"></div>')}}),_e(function(E,$){E.fn.addTxt=function(){var editor=this,txt=new E.Txt(editor);editor.txt=txt}}),_e(function(E,$){E.fn.addMenuContainer=function(){var editor=this;editor.menuContainer=new E.MenuContainer(editor)}}),_e(function(E,$){E.createMenuFns=[],E.createMenu=function(fn){E.createMenuFns.push(fn)},E.fn.addMenus=function(){function check(menuId){return menuIds.indexOf(menuId)>=0}var editor=this,menuIds=editor.config.menus;$.each(E.createMenuFns,function(k,createMenuFn){createMenuFn.call(editor,check)})}}),_e(function(E,$){E.createMenu(function(check){if(check("bold")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"bold",title:lang.bold,commandName:"Bold"});menu.clickEventSelected=function(e){editor.isRangeEmpty()?editor.commandForElem("b,strong,h1,h2,h3,h4,h5",e,"Bold"):editor.command(e,"Bold")},editor.menus.bold=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("underline")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"underline",title:lang.underline,commandName:"Underline"});menu.clickEventSelected=function(e){editor.isRangeEmpty()?editor.commandForElem("u,a",e,"Underline"):editor.command(e,"Underline")},editor.menus.underline=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("italic")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"italic",title:lang.italic,commandName:"Italic"});menu.clickEventSelected=function(e){editor.isRangeEmpty()?editor.commandForElem("i",e,"Italic"):editor.command(e,"Italic")},editor.menus.italic=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("forecolor")){var editor=this,lang=editor.config.lang,configColors=editor.config.colors,menu=new E.Menu({editor:editor,id:"forecolor",title:lang.forecolor}),$content=$("<div></div>");$.each(configColors,function(k,v){$content.append(['<a href="#" class="color-item"','    title="'+v+'" commandValue="'+k+'" ','    style="color: '+k+'" ','><i class="wangeditor-menu-img-pencil"></i></a>'].join(""))}),$content.on("click","a[commandValue]",function(e){var $elem=$(this),commandValue=$elem.attr("commandValue");menu.selected&&editor.isRangeEmpty()?editor.commandForElem("font[color]",e,"forecolor",commandValue):editor.command(e,"forecolor",commandValue)}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:125}),menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"font[color]"))},editor.menus.forecolor=menu}})}),_e(function(E,$){E.createMenu(function(check){function checkElemFn(elem){var cssText;return!!(elem&&elem.style&&null!=elem.style.cssText&&(cssText=elem.style.cssText)&&cssText.indexOf("background-color:")>=0)}if(check("bgcolor")){var editor=this,lang=editor.config.lang,configColors=editor.config.colors,menu=new E.Menu({editor:editor,id:"bgcolor",title:lang.bgcolor}),$content=$("<div></div>");$.each(configColors,function(k,v){$content.append(['<a href="#" class="color-item"','    title="'+v+'" commandValue="'+k+'" ','    style="color: '+k+'" ','><i class="wangeditor-menu-img-brush"></i></a>'].join(""))}),$content.on("click","a[commandValue]",function(e){var $elem=$(this),commandValue=$elem.attr("commandValue");menu.selected&&editor.isRangeEmpty()?editor.commandForElem({selector:"span,font",check:checkElemFn},e,"BackColor",commandValue):editor.command(e,"BackColor",commandValue)}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:125}),menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"span,font",checkElemFn))},editor.menus.bgcolor=menu}})}),_e(function(E,$){E.createMenu(function(check){var menuId="strikethrough";if(check(menuId)){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:menuId,title:lang.strikethrough,commandName:"StrikeThrough"});menu.clickEventSelected=function(e){editor.isRangeEmpty()?editor.commandForElem("strike",e,"StrikeThrough"):editor.command(e,"StrikeThrough")},editor.menus[menuId]=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("eraser")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"eraser",title:lang.eraser,commandName:"RemoveFormat"});menu.clickEvent=function(e){function commandFn(){var rangeElem,pElem,$pElem,quoteElem,$quoteElem,listElem,$listElem,editor=this;rangeElem=editor.getRangeElem(),quoteElem=editor.getSelfOrParentByName(rangeElem,"blockquote"),quoteElem&&($quoteElem=$(quoteElem),$clearElem=$("<p>"+$quoteElem.text()+"</p>"),$quoteElem.after($clearElem).remove()),pElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5"),pElem&&($pElem=$(pElem),$clearElem=$("<p>"+$pElem.text()+"</p>"),$pElem.after($clearElem).remove()),(listElem=editor.getSelfOrParentByName(rangeElem,"ul,ol"))&&($listElem=$(listElem),$clearElem=$("<p>"+$listElem.text()+"</p>"),$listElem.after($clearElem).remove())}function callback(){var editor=this;$clearElem&&editor.restoreSelectionByElem($clearElem.get(0))}if(!editor.isRangeEmpty())return void editor.command(e,"RemoveFormat");var $clearElem;editor.customCommand(e,commandFn,callback)},editor.menus.eraser=menu}})}),_e(function(E,$){E.createMenu(function(check){function updateValue(){var $code=menu.$codeTextarea,$txt=editor.txt.$txt,value=$.trim($code.val());value||(value="<p><br></p>"),editor.config.jsFilter&&(value=value.replace(/<script[\s\S]*?<\/script>/gi,""));try{$txt.html(value)}catch(ex){}}if(check("source")){var txtHtml,editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"source",title:lang.source});menu.isShowCode=!1,menu.clickEvent=function(e){var self=this,editor=self.editor,$txt=editor.txt.$txt,txtOuterHeight=$txt.outerHeight(),txtHeight=$txt.height();self.$codeTextarea||(self.$codeTextarea=$('<textarea class="code-textarea"></textarea>'));var $code=self.$codeTextarea;$code.css({height:txtHeight,"margin-top":txtOuterHeight-txtHeight}),$code.val($txt.html()),$code.on("change",function(e){updateValue()}),$txt.after($code).hide(),$code.show(),menu.isShowCode=!0,this.updateSelected(),editor.disableMenusExcept("source"),txtHtml=$txt.html()},menu.clickEventSelected=function(e){var self=this,editor=self.editor,$txt=editor.txt.$txt,$code=self.$codeTextarea;$code&&(updateValue(),$code.after($txt).hide(),$txt.show(),menu.isShowCode=!1,this.updateSelected(),editor.enableMenusExcept("source"),$txt.html()!==txtHtml&&editor.onchange&&"function"==typeof editor.onchange&&editor.onchange.call(editor))},menu.updateSelectedEvent=function(){return this.isShowCode},editor.menus.source=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("quote")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"quote",title:lang.quote,commandName:"formatBlock",commandValue:"blockquote"});menu.clickEvent=function(e){function commandFn(){$quote=$("<p>"+$rangeElem.text()+"</p>"),$rangeElem.after($quote).remove(),$quote.wrap("<blockquote>")}function callback(){var editor=this;$quote&&editor.restoreSelectionByElem($quote.get(0))}var $rangeElem,rangeElem=editor.getRangeElem();if(!rangeElem)return void e.preventDefault();var $quote,currentQuote=editor.getSelfOrParentByName(rangeElem,"blockquote");return currentQuote?void e.preventDefault():(rangeElem=editor.getLegalTags(rangeElem),$rangeElem=$(rangeElem),$rangeElem.text()?rangeElem?void editor.customCommand(e,commandFn,callback):void editor.command(e,"formatBlock","blockquote"):void 0)},menu.clickEventSelected=function(e){function commandFn(){var $quoteElem,$children;if($quoteElem=$(quoteElem),$children=$quoteElem.children(),$children.length)return $children.each(function(k){var $item=$(this);"P"===$item.get(0).nodeName?$quoteElem.after($item):$quoteElem.after("<p>"+$item.text()+"</p>"),$lastChild=$item}),void $quoteElem.remove()}function callback(){var editor=this;$lastChild&&editor.restoreSelectionByElem($lastChild.get(0))}var rangeElem,quoteElem,$lastChild;if(rangeElem=editor.getRangeElem(),!(quoteElem=editor.getSelfOrParentByName(rangeElem,"blockquote")))return void e.preventDefault();editor.customCommand(e,commandFn,callback)},menu.updateSelectedEvent=function(){var rangeElem,self=this,editor=self.editor;return rangeElem=editor.getRangeElem(),!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"blockquote"))},editor.menus.quote=menu,editor.ready(function(){var editor=this,$txt=editor.txt.$txt,isPrevEnter=!1;$txt.on("keydown",function(e){if(13!==e.keyCode)return void(isPrevEnter=!1);var rangeElem=editor.getRangeElem();if(!(rangeElem=editor.getSelfOrParentByName(rangeElem,"blockquote")))return void(isPrevEnter=!1);if(!isPrevEnter)return void(isPrevEnter=!0);var currentRangeElem=editor.getRangeElem(),$currentRangeElem=$(currentRangeElem);$currentRangeElem.length&&$currentRangeElem.parent().after($currentRangeElem),editor.restoreSelectionByElem(currentRangeElem,"start"),isPrevEnter=!1,e.preventDefault()})}),editor.ready(function(){function commandFn(){$rangeElem&&$rangeElem.remove()}function callback(){if($rangeElem){var $prev=$rangeElem.prev();$prev.length?editor.restoreSelectionByElem($prev.get(0)):editor.initSelection()}}var $rangeElem,editor=this,$txt=editor.txt.$txt;$txt.on("keydown",function(e){if(8===e.keyCode){var rangeElem=editor.getRangeElem();if(rangeElem=editor.getSelfOrParentByName(rangeElem,"blockquote")){$rangeElem=$(rangeElem);$rangeElem.text()||editor.customCommand(e,commandFn,callback)}}})})}})}),_e(function(E,$){E.createMenu(function(check){if(check("fontfamily")){var editor=this,lang=editor.config.lang,configFamilys=editor.config.familys,menu=new E.Menu({editor:editor,id:"fontfamily",title:lang.fontfamily,commandName:"fontName"}),data={};$.each(configFamilys,function(k,v){data[v]=v});menu.dropList=new E.DropList(editor,menu,{data:data,tpl:'<span style="font-family:{#commandValue};">{#title}</span>',selectorForELemCommand:"font[face]"}),menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"font[face]"))},editor.menus.fontfamily=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("fontsize")){var editor=this,lang=editor.config.lang,configSize=editor.config.fontsizes,menu=new E.Menu({editor:editor,id:"fontsize",title:lang.fontsize,commandName:"fontSize"}),data=configSize;menu.dropList=new E.DropList(editor,menu,{data:data,tpl:'<span style="font-size:{#title};">{#title}</span>',selectorForELemCommand:"font[size]"}),menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"font[size]"))},editor.menus.fontsize=menu}})}),_e(function(E,$){E.createMenu(function(check){function beforeEvent(e){editor.queryCommandState("InsertOrderedList")?(isOrderedList=!0,editor.command(e,"InsertOrderedList")):isOrderedList=!1}function afterEvent(e){isOrderedList&&editor.command(e,"InsertOrderedList")}if(check("head")){var isOrderedList,editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"head",title:lang.head,commandName:"formatBlock"}),data={"<h1>":"标题1","<h2>":"标题2","<h3>":"标题3","<h4>":"标题4","<h5>":"标题5"};menu.dropList=new E.DropList(editor,menu,{data:data,tpl:"{#commandValue}{#title}",beforeEvent:beforeEvent,afterEvent:afterEvent}),menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"h1,h2,h3,h4,h5"))},editor.menus.head=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("unorderlist")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"unorderlist",title:lang.unorderlist,commandName:"InsertUnorderedList"});editor.menus.unorderlist=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("orderlist")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"orderlist",title:lang.orderlist,commandName:"InsertOrderedList"});editor.menus.orderlist=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("alignleft")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"alignleft",title:lang.alignleft,commandName:"JustifyLeft"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,li",function(elem){var cssText;return!!(elem&&elem.style&&null!=elem.style.cssText&&(cssText=elem.style.cssText)&&/text-align:\s*left;/.test(cssText))||"left"===$(elem).attr("align")}))},editor.menus.alignleft=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("aligncenter")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"aligncenter",title:lang.aligncenter,commandName:"JustifyCenter"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,li",function(elem){var cssText;return!!(elem&&elem.style&&null!=elem.style.cssText&&(cssText=elem.style.cssText)&&/text-align:\s*center;/.test(cssText))||"center"===$(elem).attr("align")}))},editor.menus.aligncenter=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("alignright")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"alignright",title:lang.alignright,commandName:"JustifyRight"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,li",function(elem){var cssText;return!!(elem&&elem.style&&null!=elem.style.cssText&&(cssText=elem.style.cssText)&&/text-align:\s*right;/.test(cssText))||"right"===$(elem).attr("align")}))},editor.menus.alignright=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("link")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"link",title:lang.link}),$content=$("<div></div>"),$div1=$('<div style="margin:20px 10px;" class="clearfix"></div>'),$div2=$div1.clone(),$div3=$div1.clone().css("margin","0 10px"),$textInput=$('<input type="text" class="block" placeholder="'+lang.text+'"/>'),$urlInput=$('<input type="text" class="block" placeholder="'+lang.link+'"/>'),$btnSubmit=$('<button class="right">'+lang.submit+"</button>"),$btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$div1.append($textInput),$div2.append($urlInput),$div3.append($btnSubmit).append($btnCancel),$content.append($div1).append($div2).append($div3),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:300}),menu.clickEvent=function(e){var menu=this,dropPanel=menu.dropPanel;if(dropPanel.isShowing)return void dropPanel.hide();$textInput.val(""),$urlInput.val("http://");var url="",rangeElem=editor.getRangeElem();(rangeElem=editor.getSelfOrParentByName(rangeElem,"a"))&&(url=rangeElem.href||"");var text="",isRangeEmpty=editor.isRangeEmpty();isRangeEmpty?rangeElem&&(text=rangeElem.textContent||rangeElem.innerHTML):text=editor.getRangeText()||"",url&&$urlInput.val(url),text&&$textInput.val(text),isRangeEmpty?$textInput.removeAttr("disabled"):$textInput.attr("disabled",!0),dropPanel.show()},menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();return!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"a"))},$btnCancel.click(function(e){e.preventDefault(),menu.dropPanel.hide()}),$btnSubmit.click(function(e){e.preventDefault();var $linkElem,linkHtml,commandFn,callback,$oldLinks,$newLinks,rangeElem=editor.getRangeElem(),targetElem=editor.getSelfOrParentByName(rangeElem,"a"),isRangeEmpty=editor.isRangeEmpty(),$txt=editor.txt.$txt,uniqId="link"+E.random(),url=$.trim($urlInput.val()),text=$.trim($textInput.val());if(!url)return void menu.dropPanel.focusFirstInput();text||(text=url),isRangeEmpty?targetElem?($linkElem=$(targetElem),commandFn=function(){$linkElem.attr("href",url),$linkElem.text(text)},callback=function(){this.restoreSelectionByElem(targetElem)},editor.customCommand(e,commandFn,callback)):(linkHtml='<a href="'+url+'" target="_blank">'+text+"</a>",E.userAgent.indexOf("Firefox")>0&&(linkHtml+="<span>&nbsp;</span>"),editor.command(e,"insertHtml",linkHtml)):($oldLinks=$txt.find("a"),$oldLinks.attr(uniqId,"1"),editor.command(e,"createLink",url),$newLinks=$txt.find("a").not("["+uniqId+"]"),$newLinks.attr("target","_blank"),$oldLinks.removeAttr(uniqId))}),editor.menus.link=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("unlink")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"unlink",title:lang.unlink,commandName:"unLink"});menu.clickEvent=function(e){function commandFn(){$a.after($span).remove()}function callback(){editor.restoreSelectionByElem($span.get(0))}if(!editor.isRangeEmpty())return void editor.command(e,"unLink");var rangeElem=editor.getRangeElem(),aElem=editor.getSelfOrParentByName(rangeElem,"a");if(!aElem)return void e.preventDefault();var $a=$(aElem),$span=$("<span>"+$a.text()+"</span>");editor.customCommand(e,commandFn,callback)},editor.menus.unlink=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("table")){
var $tr,i,j,editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"table",title:lang.table}),$content=$('<div style="font-size: 14px; color: #666; text-align:right;"></div>'),$table=$('<table class="choose-table" style="margin-bottom:10px;margin-top:5px;">'),$row=$("<span>0</span>"),$rowspan=$("<span> 行 </span>"),$col=$("<span>0</span>"),$colspan=$("<span> 列</span>");for(i=0;i<15;i++){for($tr=$('<tr index="'+(i+1)+'">'),j=0;j<20;j++)$tr.append($('<td index="'+(j+1)+'">'));$table.append($tr)}$content.append($table),$content.append($row).append($rowspan).append($col).append($colspan),$table.on("mouseenter","td",function(e){var $currentTd=$(e.currentTarget),currentTdIndex=$currentTd.attr("index"),$currentTr=$currentTd.parent(),currentTrIndex=$currentTr.attr("index");$row.text(currentTrIndex),$col.text(currentTdIndex),$table.find("tr").each(function(){var $tr=$(this),trIndex=$tr.attr("index");parseInt(trIndex,10)<=parseInt(currentTrIndex,10)?$tr.find("td").each(function(){var $td=$(this),tdIndex=$td.attr("index");parseInt(tdIndex,10)<=parseInt(currentTdIndex,10)?$td.addClass("active"):$td.removeClass("active")}):$tr.find("td").removeClass("active")})}).on("mouseleave",function(e){$table.find("td").removeClass("active"),$row.text(0),$col.text(0)}),$table.on("click","td",function(e){var i,j,$currentTd=$(e.currentTarget),currentTdIndex=$currentTd.attr("index"),$currentTr=$currentTd.parent(),currentTrIndex=$currentTr.attr("index"),rownum=parseInt(currentTrIndex,10),colnum=parseInt(currentTdIndex,10),tableHtml="<table>";for(i=0;i<rownum;i++){for(tableHtml+="<tr>",j=0;j<colnum;j++)tableHtml+="<td><span>&nbsp;</span></td>";tableHtml+="</tr>"}tableHtml+="</table>",editor.command(e,"insertHtml",tableHtml)}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:262}),editor.menus.table=menu}})}),_e(function(E,$){E.createMenu(function(check){function insertEmotionImgs(data,$tabContent){$.each(data,function(k,emotion){var src=emotion.icon||emotion.url,value=emotion.value||emotion.title,commandValue="icon"===emotionsShow?src:value,$command=$('<a href="#" commandValue="'+commandValue+'"></a>'),$img=$("<img>");$img.attr("_src",src),$command.append($img),$tabContent.append($command),editor.emotionUrls.push(src)})}if(check("emotion")){var editor=this,config=editor.config,lang=config.lang,configEmotions=config.emotions,emotionsShow=config.emotionsShow;editor.emotionUrls=[];var menu=new E.Menu({editor:editor,id:"emotion",title:lang.emotion}),$panelContent=$('<div class="panel-tab"></div>'),$tabContainer=$('<div class="tab-container"></div>'),$contentContainer=$('<div class="content-container emotion-content-container"></div>');$.each(configEmotions,function(k,emotion){var title=emotion.title,data=emotion.data;E.log("正在处理 "+title+" 表情的数据...");var $tab=$('<a href="#">'+title+" </a>");$tabContainer.append($tab);var $tabContent=$('<div class="content"></div>');if($contentContainer.append($tabContent),$tab.click(function(e){$tabContainer.children().removeClass("selected"),$contentContainer.children().removeClass("selected"),$tabContent.addClass("selected"),$tab.addClass("selected"),e.preventDefault()}),"string"==typeof data)E.log("将通过 "+data+" 地址ajax下载表情包"),$.get(data,function(result){result=$.parseJSON(result),E.log("下载完毕，得到 "+result.length+" 个表情"),insertEmotionImgs(result,$tabContent)});else{if(!(Object.prototype.toString.call(data).toLowerCase().indexOf("array")>0))return void E.error("data 数据格式错误，请修改为正确格式，参考文档："+E.docsite);insertEmotionImgs(data,$tabContent)}}),$panelContent.append($tabContainer).append($contentContainer),$tabContainer.children().first().addClass("selected"),$contentContainer.children().first().addClass("selected"),$contentContainer.on("click","a[commandValue]",function(e){var $a=$(e.currentTarget),commandValue=$a.attr("commandValue");"icon"===emotionsShow?editor.command(e,"InsertImage",commandValue):editor.command(e,"insertHtml","<span>"+commandValue+"</span>"),e.preventDefault()}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$panelContent,width:350}),menu.clickEvent=function(e){var menu=this,dropPanel=menu.dropPanel;if(dropPanel.isShowing)return void dropPanel.hide();dropPanel.show(),menu.imgLoaded||($contentContainer.find("img").each(function(){var $img=$(this),_src=$img.attr("_src");$img.on("error",function(){E.error("加载不出表情图片 "+_src)}),$img.attr("src",_src),$img.removeAttr("_src")}),menu.imgLoaded=!0)},editor.menus.emotion=menu}})}),_e(function(E,$){function linkContentHandler(editor,menu,$linkContent){function callback(){$urlInput.val("")}var lang=editor.config.lang,$urlContainer=$('<div style="margin:20px 10px 10px 10px;"></div>'),$urlInput=$('<input type="text" class="block" placeholder="http://"/>');$urlContainer.append($urlInput);var $btnSubmit=$('<button class="right">'+lang.submit+"</button>"),$btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$linkContent.append($urlContainer).append($btnSubmit).append($btnCancel),$btnCancel.click(function(e){e.preventDefault(),menu.dropPanel.hide()}),$btnSubmit.click(function(e){e.preventDefault();var url=$.trim($urlInput.val());if(!url)return void $urlInput.focus();var imgHtml='<img style="max-width:100%;" src="'+url+'"/>';editor.command(e,"insertHtml",imgHtml,callback)})}E.createMenu(function(check){function tabToggle(){$uploadTab.click(function(e){$tabContainer.children().removeClass("selected"),$contentContainer.children().removeClass("selected"),$uploadContent.addClass("selected"),$uploadTab.addClass("selected"),e.preventDefault()}),$linkTab.click(function(e){$tabContainer.children().removeClass("selected"),$contentContainer.children().removeClass("selected"),$linkContent.addClass("selected"),$linkTab.addClass("selected"),e.preventDefault(),E.placeholder&&$linkContent.find("input[type=text]").focus()}),$uploadTab.click()}function hideUploadImg(){$tabContainer.remove(),$uploadContent.remove(),$linkContent.addClass("selected")}function hideLinkImg(){$tabContainer.remove(),$linkContent.remove(),$uploadContent.addClass("selected")}if(check("img")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"img",title:lang.img}),$panelContent=$('<div class="panel-tab"></div>'),$tabContainer=$('<div class="tab-container"></div>'),$contentContainer=$('<div class="content-container"></div>');$panelContent.append($tabContainer).append($contentContainer);var $uploadTab=$('<a href="#">上传图片</a>'),$linkTab=$('<a href="#">网络图片</a>');$tabContainer.append($uploadTab).append($linkTab);var $uploadContent=$('<div class="content"></div>');$contentContainer.append($uploadContent);var $linkContent=$('<div class="content"></div>');$contentContainer.append($linkContent),linkContentHandler(editor,menu,$linkContent),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$panelContent,width:400,onRender:function(){var init=editor.config.customUploadInit;init&&init.call(editor)}}),editor.menus.img=menu,editor.ready(function(){function hidePanel(){menu.dropPanel.hide()}var editor=this,config=editor.config,uploadImgUrl=config.uploadImgUrl,customUpload=config.customUpload,linkImg=config.hideLinkImg;uploadImgUrl||customUpload?(editor.$uploadContent=$uploadContent,tabToggle(),linkImg&&hideLinkImg()):hideUploadImg(),$uploadContent.click(function(){setTimeout(hidePanel)})})}})}),_e(function(E,$){E.createMenu(function(check){if(check("video")){var editor=this,lang=editor.config.lang,reg=/^<(iframe)|(embed)/i,menu=new E.Menu({editor:editor,id:"video",title:lang.video}),$content=$("<div></div>"),$linkInputContainer=$('<div style="margin:20px 10px;"></div>'),$linkInput=$('<input type="text" class="block" placeholder=\'格式如：<iframe src="..." frameborder=0 allowfullscreen></iframe>\'/>');$linkInputContainer.append($linkInput);var $sizeContainer=$('<div style="margin:20px 10px;"></div>'),$widthInput=$('<input type="text" value="640" style="width:50px;text-align:center;"/>'),$heightInput=$('<input type="text" value="498" style="width:50px;text-align:center;"/>');$sizeContainer.append("<span> "+lang.width+" </span>").append($widthInput).append("<span> px &nbsp;&nbsp;&nbsp;</span>").append("<span> "+lang.height+" </span>").append($heightInput).append("<span> px </span>");var $btnContainer=$("<div></div>"),$howToCopy=$('<a href="http://www.kancloud.cn/wangfupeng/wangeditor2/134973" target="_blank" style="display:inline-block;margin-top:10px;margin-left:10px;color:#999;">如何复制视频链接？</a>'),$btnSubmit=$('<button class="right">'+lang.submit+"</button>"),$btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$btnContainer.append($howToCopy).append($btnSubmit).append($btnCancel),$content.append($linkInputContainer).append($sizeContainer).append($btnContainer),$btnCancel.click(function(e){e.preventDefault(),$linkInput.val(""),menu.dropPanel.hide()}),$btnSubmit.click(function(e){e.preventDefault();var $link,link=$.trim($linkInput.val()),width=parseInt($widthInput.val()),height=parseInt($heightInput.val()),$div=$("<div>"),html="<p>{content}</p>";return link?reg.test(link)?isNaN(width)||isNaN(height)?void alert("宽度或高度不是数字！"):($link=$(link),$link.attr("width",width).attr("height",height),html=html.replace("{content}",$div.append($link).html()),editor.command(e,"insertHtml",html),void $linkInput.val("")):(alert("视频链接格式错误！"),void menu.dropPanel.focusFirstInput()):void menu.dropPanel.focusFirstInput()}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:400}),editor.menus.video=menu}})}),_e(function(E,$){var inputKeyup=function(input){return"onkeyup"in input}(document.createElement("input"));E.baiduMapAk="TVhjYjq1ICT2qqL5LdS8mwas",E.numberOfLocation=0,E.createMenu(function(check){function callback(){$searchInput.val("")}if(check("location")){if(++E.numberOfLocation>1)return void E.error("目前不支持在一个页面多个编辑器上同时使用地图，可通过自定义菜单配置去掉地图菜单");var editor=this,config=editor.config,lang=config.lang,ak=config.mapAk;editor.mapData={};var mapData=editor.mapData;mapData.markers=[],mapData.mapContainerId="map"+E.random(),mapData.clearLocations=function(){var map=mapData.map;map&&(map.clearOverlays(),mapData.markers=[])},mapData.searchMap=function(){var map=mapData.map;if(map){var myGeo,marker,BMap=window.BMap,cityName=$cityInput.val(),locationName=$searchInput.val();""!==cityName&&(locationName&&""!==locationName||map.centerAndZoom(cityName,11),locationName&&""!==locationName&&(myGeo=new BMap.Geocoder,myGeo.getPoint(locationName,function(point){point?(map.centerAndZoom(point,13),marker=new BMap.Marker(point),map.addOverlay(marker),marker.enableDragging(),mapData.markers.push(marker)):map.centerAndZoom(cityName,11)},cityName)))}};var hasCallback=!1;window.baiduMapCallBack=function(){function locationFun(result){var cityName=result.name;map.setCenter(cityName),$cityInput.val(cityName),E.placeholder&&$searchInput.focus();var timeoutId,searchFn;inputKeyup?(searchFn=function(e){"keyup"===e.type&&13===e.keyCode&&e.preventDefault(),timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(mapData.searchMap,500)},$cityInput.on("keyup change paste",searchFn),$searchInput.on("keyup change paste",searchFn)):(searchFn=function(){if(!$content.is(":visible"))return void clearTimeout(timeoutId);var currentCity="",currentSearch="",city=$cityInput.val(),search=$searchInput.val();city===currentCity&&search===currentSearch||(mapData.searchMap(),currentCity=city,currentSearch=search),timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(searchFn,1e3)},timeoutId=setTimeout(searchFn,1e3))}if(!hasCallback){hasCallback=!0;var BMap=window.BMap;mapData.map||(mapData.map=new BMap.Map(mapData.mapContainerId));var map=mapData.map;map.centerAndZoom(new BMap.Point(116.404,39.915),11),map.addControl(new BMap.MapTypeControl),map.setCurrentCity("北京"),map.enableScrollWheelZoom(!0);(new BMap.LocalCity).get(locationFun),map.addEventListener("click",function(e){var marker=new BMap.Marker(new BMap.Point(e.point.lng,e.point.lat));map.addOverlay(marker),marker.enableDragging(),mapData.markers.push(marker)},!1)}},mapData.loadMapScript=function(){var script=document.createElement("script");script.type="text/javascript",script.src="https://api.map.baidu.com/api?v=2.0&ak="+ak+"&s=1&callback=baiduMapCallBack";try{document.body.appendChild(script)}catch(ex){E.error("加载地图过程中发生错误")}},mapData.initMap=function(){window.BMap?window.baiduMapCallBack():mapData.loadMapScript()};var menu=new E.Menu({editor:editor,id:"location",title:lang.location});editor.menus.location=menu;var $content=$("<div></div>"),$inputContainer=$('<div style="margin:10px 0;"></div>'),$cityInput=$('<input type="text"/>');$cityInput.css({width:"80px","text-align":"center"});var $searchInput=$('<input type="text"/>');$searchInput.css({width:"300px","margin-left":"10px"}).attr("placeholder",lang.searchlocation);var $clearBtn=$('<button class="right link">'+lang.clearLocation+"</button>");$inputContainer.append($clearBtn).append($cityInput).append($searchInput),$content.append($inputContainer),$clearBtn.click(function(e){$searchInput.val(""),$searchInput.focus(),mapData.clearLocations(),e.preventDefault()});var $map=$('<div id="'+mapData.mapContainerId+'"></div>');$map.css({height:"260px",width:"100%",position:"relative","margin-top":"10px",border:"1px solid #f1f1f1"});var $mapLoading=$("<span>"+lang.loading+"</span>");$mapLoading.css({position:"absolute",width:"100px","text-align":"center",top:"45%",left:"50%","margin-left":"-50px"}),$map.append($mapLoading),$content.append($map);var $btnContainer=$('<div style="margin:10px 0;"></div>'),$btnSubmit=$('<button class="right">'+lang.submit+"</button>"),$btnCancel=$('<button class="right gray">'+lang.cancel+"</button>"),$checkLabel=$('<label style="display:inline-block;margin-top:10px;color:#666;"></label>'),$check=$('<input type="checkbox">');$checkLabel.append($check).append('<span style="display:inline-block;margin-left:5px;">  '+lang.dynamicMap+"</span>"),$btnContainer.append($checkLabel).append($btnSubmit).append($btnCancel),$content.append($btnContainer),$btnCancel.click(function(e){e.preventDefault(),callback(),menu.dropPanel.hide()}),$btnSubmit.click(function(e){e.preventDefault();var position,src,iframe,map=mapData.map,isDynamic=$check.is(":checked"),markers=mapData.markers,center=map.getCenter(),centerLng=center.lng,centerLat=center.lat,zoom=map.getZoom(),size=map.getSize(),sizeWidth=size.width,sizeHeight=size.height;if(src=isDynamic?"http://ueditor.baidu.com/ueditor/dialogs/map/show.html#":"http://api.map.baidu.com/staticimage?",src=src+"center="+centerLng+","+centerLat+"&zoom="+zoom+"&width="+sizeWidth+"&height="+sizeHeight,markers.length>0&&(src+="&markers=",$.each(markers,function(key,value){position=value.getPosition(),key>0&&(src+="|"),src=src+position.lng+","+position.lat})),isDynamic){if(markers.length>1)return void alert(lang.langDynamicOneLocation);src+="&markerStyles=l,A",iframe='<iframe class="ueditor_baidumap" src="{src}" frameborder="0" width="'+sizeWidth+'" height="'+sizeHeight+'"></iframe>',iframe=iframe.replace("{src}",src),editor.command(e,"insertHtml",iframe,callback)}else editor.command(e,"insertHtml",'<img style="max-width:100%;" src="'+src+'"/>',callback)}),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:500}),menu.onRender=function(){ak===E.baiduMapAk&&E.warn("建议在配置中自定义百度地图的mapAk，否则可能影响地图功能，文档："+E.docsite)},menu.clickEvent=function(e){var menu=this,dropPanel=menu.dropPanel,firstTime=!1;if(dropPanel.isShowing)return void dropPanel.hide();mapData.map||(firstTime=!0),dropPanel.show(),mapData.initMap(),firstTime||$searchInput.focus()}}})}),_e(function(E,$){function loadHljs(){if(!(E.userAgent.indexOf("MSIE 8")>0||window.hljs)){var script=document.createElement("script");script.type="text/javascript",script.src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js",document.body.appendChild(script)}}E.createMenu(function(check){function updateMenu(){var rangeElem=editor.getRangeElem();editor.getSelfOrParentByName(rangeElem,"code")?editor.disableMenusExcept("insertcode"):editor.enableMenusExcept("insertcode")}if(check("insertcode")){setTimeout(loadHljs,0);var editor=this,config=editor.config,lang=config.lang,$txt=editor.txt.$txt,menu=new E.Menu({editor:editor,id:"insertcode",title:lang.insertcode});menu.clickEvent=function(e){var menu=this,dropPanel=menu.dropPanel;if(dropPanel.isShowing)return void dropPanel.hide();$textarea.val(""),dropPanel.show();var hljs=window.hljs;if(hljs&&hljs.listLanguages){if(0!==$langSelect.children().length)return;$langSelect.css({"margin-top":"9px","margin-left":"5px"}),$.each(hljs.listLanguages(),function(key,lang){"xml"===lang&&(lang="html"),lang===config.codeDefaultLang?$langSelect.append('<option value="'+lang+'" selected="selected">'+lang+"</option>"):$langSelect.append('<option value="'+lang+'">'+lang+"</option>")})}else $langSelect.hide()},menu.clickEventSelected=function(e){var menu=this,dropPanel=menu.dropPanel;if(dropPanel.isShowing)return void dropPanel.hide();dropPanel.show();var $targetElem,className,rangeElem=editor.getRangeElem(),targetElem=editor.getSelfOrParentByName(rangeElem,"pre");targetElem&&(targetElem=editor.getSelfOrParentByName(rangeElem,"code")),targetElem&&($targetElem=$(targetElem),$textarea.val($targetElem.text()),$langSelect&&(className=$targetElem.attr("class"))&&$langSelect.val(className.split(" ")[0]))},menu.updateSelectedEvent=function(){var rangeElem,self=this,editor=self.editor;return rangeElem=editor.getRangeElem(),!!(rangeElem=editor.getSelfOrParentByName(rangeElem,"pre"))};var $content=$("<div></div>"),$textarea=$("<textarea></textarea>"),$langSelect=$("<select></select>");!function($content){var $textareaContainer=$("<div></div>");$textareaContainer.css({margin:"15px 5px 5px 5px",height:"160px","text-align":"center"}),$textarea.css({width:"100%",height:"100%",padding:"10px"}),$textarea.on("keydown",function(e){9===e.keyCode&&e.preventDefault()}),$textareaContainer.append($textarea),$content.append($textareaContainer);var $btnContainer=$("<div></div>"),$btnSubmit=$('<button class="right">'+lang.submit+"</button>"),$btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$btnContainer.append($btnSubmit).append($btnCancel).append($langSelect),$content.append($btnContainer),$btnCancel.click(function(e){e.preventDefault(),menu.dropPanel.hide()});var codeTpl='<pre style="max-width:100%;overflow-x:auto;"><code{#langClass}>{#content}</code></pre>';$btnSubmit.click(function(e){function commandFn(){lang&&$targetElem.attr("class")!==lang+" hljs"&&$targetElem.attr("class",lang+" hljs"),$targetElem.html(val)}function callback(){editor.restoreSelectionByElem(targetElem),doHightlight()}e.preventDefault();var val=$textarea.val();if(!val)return void $textarea.focus();var rangeElem=editor.getRangeElem();$.trim($(rangeElem).text())&&0!==codeTpl.indexOf("<p><br></p>")&&(codeTpl="<p><br></p>"+codeTpl);var lang=$langSelect?$langSelect.val():"",langClass="",doHightlight=function(){$txt.find("pre code").each(function(i,block){var $block=$(block);$block.attr("codemark")||window.hljs&&(window.hljs.highlightBlock(block),$block.attr("codemark","1"))})};if(lang&&(langClass=' class="'+lang+' hljs"'),val=val.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;"),!menu.selected){var html=codeTpl.replace("{#langClass}",langClass).replace("{#content}",val);return void editor.command(e,"insertHtml",html,doHightlight)}var $targetElem,targetElem=editor.getSelfOrParentByName(rangeElem,"pre");targetElem&&(targetElem=editor.getSelfOrParentByName(rangeElem,"code")),targetElem&&($targetElem=$(targetElem),editor.customCommand(e,commandFn,callback))})}($content),menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:500}),editor.menus.insertcode=menu,$txt.on("keydown",function(e){if(13===e.keyCode){var rangeElem=editor.getRangeElem();editor.getSelfOrParentByName(rangeElem,"code")&&editor.command(e,"insertHtml","\n")}}),$txt.on("keydown click",function(e){setTimeout(updateMenu)})}})}),_e(function(E,$){E.createMenu(function(check){if(check("undo")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"undo",title:lang.undo});menu.clickEvent=function(e){editor.undo()},editor.menus.undo=menu,editor.ready(function(){function undo(){editor.undoRecord()}var timeoutId,editor=this,$txt=editor.txt.$txt;$txt.on("keydown",function(e){var keyCode=e.keyCode;if(e.ctrlKey&&90===keyCode)return void editor.undo();13===keyCode?undo():(timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout(undo,1e3))}),editor.undoRecord()})}})}),_e(function(E,$){E.createMenu(function(check){if(check("redo")){var editor=this,lang=editor.config.lang,menu=new E.Menu({editor:editor,id:"redo",title:lang.redo});menu.clickEvent=function(e){editor.redo()},editor.menus.redo=menu}})}),_e(function(E,$){var scrollTopWhenFullScreen;E.createMenu(function(check){if(check("fullscreen")){var zIndex,maxHeight,editor=this,$txt=editor.txt.$txt,config=editor.config,zIndexConfig=config.zindex||1e4,lang=config.lang,isSelected=!1,menu=new E.Menu({editor:editor,id:"fullscreen",title:lang.fullscreen});menu.clickEvent=function(e){var $editorContainer=editor.$editorContainer;$editorContainer.addClass("wangEditor-fullscreen"),zIndex=$editorContainer.css("z-index"),$editorContainer.css("z-index",zIndexConfig);var $wrapper,txtHeight=$txt.height(),txtOuterHeight=$txt.outerHeight();editor.useMaxHeight&&(maxHeight=$txt.css("max-height"),$txt.css("max-height","none"),$wrapper=$txt.parent(),$wrapper.after($txt),$wrapper.remove(),$txt.css("overflow-y","auto"));var menuContainer=editor.menuContainer;$txt.height(E.$window.height()-menuContainer.height()-(txtOuterHeight-txtHeight)),editor.menuContainer.$menuContainer.attr("style",""),isSelected=!0,editor.isFullScreen=!0,scrollTopWhenFullScreen=E.$window.scrollTop()},menu.clickEventSelected=function(e){var $editorContainer=editor.$editorContainer;$editorContainer.removeClass("wangEditor-fullscreen"),$editorContainer.css("z-index",zIndex),editor.useMaxHeight?$txt.css("max-height",maxHeight):editor.$valueContainer.css("height",editor.valueContainerHeight),editor.txt.initHeight(),isSelected=!1,editor.isFullScreen=!1,null!=scrollTopWhenFullScreen&&E.$window.scrollTop(scrollTopWhenFullScreen)},menu.updateSelectedEvent=function(e){return isSelected},editor.menus.fullscreen=menu}})}),_e(function(E,$){E.fn.renderMenus=function(){var menu,editor=this,menus=editor.menus,menuIds=editor.config.menus,groupIdx=(editor.menuContainer,0);$.each(menuIds,function(k,v){if("|"===v)return void groupIdx++;(menu=menus[v])&&menu.render(groupIdx)})}}),_e(function(E,$){E.fn.renderMenuContainer=function(){var editor=this,menuContainer=editor.menuContainer;editor.$editorContainer;menuContainer.render()}}),_e(function(E,$){E.fn.renderTxt=function(){var editor=this,txt=editor.txt;txt.render(),editor.ready(function(){txt.initHeight()})}}),_e(function(E,$){E.fn.renderEditorContainer=function(){var $prev,$parent,editor=this,$valueContainer=editor.$valueContainer,$editorContainer=editor.$editorContainer,$txt=editor.txt.$txt;$valueContainer===$txt?($prev=editor.$prev,$parent=editor.$parent,$prev&&$prev.length?$prev.after($editorContainer):$parent.prepend($editorContainer)):($valueContainer.after($editorContainer),$valueContainer.hide())}}),_e(function(E,$){E.fn.eventMenus=function(){var menus=this.menus;$.each(menus,function(k,v){v.bindEvent()})}}),_e(function(E,$){E.fn.eventMenuContainer=function(){}}),_e(function(E,$){E.fn.eventTxt=function(){var txt=this.txt;txt.saveSelectionEvent(),txt.updateValueEvent(),txt.updateMenuStyleEvent()}}),_e(function(E,$){E.plugin(function(){var editor=this,fns=editor.config.uploadImgFns;fns.onload||(fns.onload=function(resultText,xhr){E.log("上传结束，返回结果为 "+resultText);var img,editor=this,originalName=editor.uploadImgOriginalName||"";0===resultText.indexOf("error|")?(E.warn("上传失败："+resultText.split("|")[1]),alert(resultText.split("|")[1])):(E.log("上传成功，即将插入编辑区域，结果为："+resultText),img=document.createElement("img"),img.onload=function(){var html='<img src="'+resultText+'" alt="'+originalName+'" style="max-width:100%;"/>';editor.command(null,"insertHtml",html),E.log("已插入图片，地址 "+resultText),img=null},img.onerror=function(){E.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+resultText),img=null},img.src=resultText)}),fns.ontimeout||(fns.ontimeout=function(xhr){E.error("上传图片超时"),alert("上传图片超时")}),fns.onerror||(fns.onerror=function(xhr){E.error("上传上图片发生错误"),alert("上传上图片发生错误")})})}),_e(function(E,$){window.FileReader&&window.FormData&&E.plugin(function(){function convertBase64UrlToBlob(urlData,filetype){var i,bytes=window.atob(urlData.split(",")[1]),ab=new ArrayBuffer(bytes.length),ia=new Uint8Array(ab);for(i=0;i<bytes.length;i++)ia[i]=bytes.charCodeAt(i);return new Blob([ab],{type:filetype})}function insertImg(src,event){var img=document.createElement("img");img.onload=function(){var html='<img src="'+src+'" style="max-width:100%;"/>';editor.command(event,"insertHtml",html),E.log("已插入图片，地址 "+src),img=null},img.onerror=function(){E.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+src),img=null},img.src=src}function updateProgress(e){if(e.lengthComputable){var percentComplete=e.loaded/e.total;editor.showUploadProgress(100*percentComplete)}}var editor=this,config=editor.config,uploadImgUrl=config.uploadImgUrl,uploadTimeout=config.uploadTimeout,uploadImgFns=config.uploadImgFns,onload=uploadImgFns.onload,ontimeout=uploadImgFns.ontimeout,onerror=uploadImgFns.onerror;uploadImgUrl&&(editor.xhrUploadImg=function(opt){function timeoutCallback(){timeoutId&&clearTimeout(timeoutId),xhr&&xhr.abort&&xhr.abort(),event.preventDefault(),timeoutfn&&timeoutfn.call(editor,xhr),editor.hideUploadProgress()}var event=opt.event,fileName=opt.filename||"",base64=opt.base64,fileType=opt.fileType||"image/png",name=opt.name||"wangEditor_upload_file",loadfn=opt.loadfn||onload,errorfn=opt.errorfn||onerror,timeoutfn=opt.timeoutfn||ontimeout,params=editor.config.uploadParams||{},headers=editor.config.uploadHeaders||{},fileExt="png";if(fileName.indexOf(".")>0?fileExt=fileName.slice(fileName.lastIndexOf(".")-fileName.length+1):fileType.indexOf("/")>0&&fileType.split("/")[1]&&(fileExt=fileType.split("/")[1]),E.isOnWebsite)return E.log("预览模拟上传"),void insertImg(base64,event);var timeoutId,xhr=new XMLHttpRequest,formData=new FormData;xhr.onload=function(){timeoutId&&clearTimeout(timeoutId),editor.uploadImgOriginalName=fileName,fileName.indexOf(".")>0&&(editor.uploadImgOriginalName=fileName.split(".")[0]),loadfn&&loadfn.call(editor,xhr.responseText,xhr),editor.hideUploadProgress()},xhr.onerror=function(){timeoutId&&clearTimeout(timeoutId),event.preventDefault(),errorfn&&errorfn.call(editor,xhr),editor.hideUploadProgress()},xhr.upload.onprogress=updateProgress,formData.append(name,convertBase64UrlToBlob(base64,fileType),E.random()+"."+fileExt),$.each(params,function(key,value){formData.append(key,value)}),xhr.open("POST",uploadImgUrl,!0),$.each(headers,function(key,value){xhr.setRequestHeader(key,value)}),xhr.withCredentials=!0,xhr.send(formData),timeoutId=setTimeout(timeoutCallback,uploadTimeout),E.log("开始上传...并开始超时计算")})})}),_e(function(E,$){E.plugin(function(){function render(){isRender||(isRender=!0,$progress.css({top:menuHeight+"px"}),$editorContainer.append($progress))}function hideProgress(){$progress.hide(),timeoutId=null}var editor=this,menuContainer=editor.menuContainer,menuHeight=menuContainer.height(),$editorContainer=editor.$editorContainer,width=$editorContainer.width(),$progress=$('<div class="wangEditor-upload-progress"></div>'),isRender=!1;editor.showUploadProgress=function(progress){timeoutId&&clearTimeout(timeoutId),render(),$progress.show(),$progress.width(progress*width/100)};var timeoutId;editor.hideUploadProgress=function(time){timeoutId&&clearTimeout(timeoutId),time=time||750,timeoutId=setTimeout(hideProgress,time)}})}),_e(function(E,$){E.plugin(function(){var event,editor=this,config=editor.config,uploadImgUrl=config.uploadImgUrl,uploadTimeout=config.uploadTimeout;if(uploadImgUrl){var $uploadContent=editor.$uploadContent;if($uploadContent){var $uploadIcon=$('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');$uploadContent.append($uploadIcon);var upfile=new E.UploadFile({editor:editor,uploadUrl:uploadImgUrl,timeout:uploadTimeout,fileAccept:"image/jpg,image/jpeg,image/png,image/gif,image/bmp"});$uploadIcon.click(function(e){event=e,upfile.selectFiles()})}}})}),_e(function(E,$){if(window.FileReader&&window.FormData){var UploadFile=function(opt){this.editor=opt.editor,this.uploadUrl=opt.uploadUrl,this.timeout=opt.timeout,this.fileAccept=opt.fileAccept,this.multiple=!0};UploadFile.fn=UploadFile.prototype,UploadFile.fn.clear=function(){this.$input.val(""),E.log("input value 已清空")},UploadFile.fn.render=function(){var self=this;if(!self._hasRender){E.log("渲染dom");var fileAccept=self.fileAccept,acceptTpl=fileAccept?'accept="'+fileAccept+'"':"",multiple=self.multiple,multipleTpl=multiple?'multiple="multiple"':"",$input=$('<input type="file" '+acceptTpl+" "+multipleTpl+"/>"),$container=$('<div style="visibility:hidden;"></div>');$container.append($input),E.$body.append($container),$input.on("change",function(e){self.selected(e,$input.get(0))}),self.$input=$input,self._hasRender=!0}},UploadFile.fn.selectFiles=function(){var self=this;E.log("使用 html5 方式上传"),self.render(),E.log("选择文件"),self.$input.click()},UploadFile.fn.selected=function(e,input){var self=this,files=input.files||[];0!==files.length&&(E.log("选中 "+files.length+" 个文件"),$.each(files,function(key,value){self.upload(value)}))},UploadFile.fn.upload=function(file){function clearInput(){self.clear()}var self=this,editor=self.editor,filename=file.name||"",fileType=file.type||"",uploadImgFns=editor.config.uploadImgFns,uploadFileName=editor.config.uploadImgFileName||"wangEditorH5File",onload=uploadImgFns.onload,ontimeout=uploadImgFns.ontimeout,onerror=uploadImgFns.onerror,reader=new FileReader;if(!onload||!ontimeout||!onerror)return void E.error("请为编辑器配置上传图片的 onload ontimeout onerror 回调事件");E.log("开始执行 "+filename+" 文件的上传"),reader.onload=function(e){E.log("已读取"+filename+"文件");var base64=e.target.result||this.result;editor.xhrUploadImg({event:e,filename:filename,base64:base64,fileType:fileType,name:uploadFileName,loadfn:function(resultText,xhr){clearInput();var editor=this;onload.call(editor,resultText,xhr)},errorfn:function(xhr){clearInput(),E.isOnWebsite&&alert("wangEditor官网暂时没有服务端，因此报错。实际项目中不会发生");var editor=this;onerror.call(editor,xhr)},timeoutfn:function(xhr){clearInput(),E.isOnWebsite&&alert("wangEditor官网暂时没有服务端，因此超时。实际项目中不会发生"),ontimeout(this,xhr)}})},reader.readAsDataURL(file)},E.UploadFile=UploadFile}}),_e(function(E,$){if(!window.FileReader||!window.FormData){var UploadFile=function(opt){this.editor=opt.editor,this.uploadUrl=opt.uploadUrl,this.timeout=opt.timeout,this.fileAccept=opt.fileAccept,this.multiple=!1};UploadFile.fn=UploadFile.prototype,UploadFile.fn.clear=function(){this.$input.val(""),E.log("input value 已清空")},UploadFile.fn.hideModal=function(){this.modal.hide()},UploadFile.fn.render=function(){var self=this,editor=self.editor,uploadFileName=editor.config.uploadImgFileName||"wangEditorFormFile";if(!self._hasRender){var uploadUrl=self.uploadUrl;E.log("渲染dom");var iframeId="iframe"+E.random(),$iframe=$('<iframe name="'+iframeId+'" id="'+iframeId+'" frameborder="0" width="0" height="0"></iframe>'),multiple=self.multiple,multipleTpl=multiple?'multiple="multiple"':"",$p=$("<p>选择图片并上传</p>"),$input=$('<input type="file" '+multipleTpl+' name="'+uploadFileName+'"/>'),$btn=$('<input type="submit" value="上传"/>'),$form=$('<form enctype="multipart/form-data" method="post" action="'+uploadUrl+'" target="'+iframeId+'"></form>'),$container=$('<div style="margin:10px 20px;"></div>');$form.append($p).append($input).append($btn),$.each(editor.config.uploadParams,function(key,value){$form.append($('<input type="hidden" name="'+key+'" value="'+value+'"/>'))}),$container.append($form),$container.append($iframe),self.$input=$input,self.$iframe=$iframe;var modal=new E.Modal(editor,void 0,{$content:$container});self.modal=modal,
self._hasRender=!0}},UploadFile.fn.bindLoadEvent=function(){function onloadFn(){var resultText=$.trim(iframeWindow.document.body.innerHTML);if(resultText){var fileFullName=self.$input.val(),fileOriginalName=fileFullName;fileFullName.lastIndexOf("\\")>=0&&(fileOriginalName=fileFullName.slice(fileFullName.lastIndexOf("\\")+1),fileOriginalName.indexOf(".")>0&&(fileOriginalName=fileOriginalName.split(".")[0])),editor.uploadImgOriginalName=fileOriginalName,onload.call(editor,resultText),self.clear(),self.hideModal()}}var self=this;if(!self._hasBindLoad){var editor=self.editor,$iframe=self.$iframe,iframe=$iframe.get(0),iframeWindow=iframe.contentWindow,onload=editor.config.uploadImgFns.onload;iframe.attachEvent?iframe.attachEvent("onload",onloadFn):iframe.onload=onloadFn,self._hasBindLoad=!0}},UploadFile.fn.show=function(){function show(){modal.show(),self.bindLoadEvent()}var self=this,modal=self.modal;setTimeout(show)},UploadFile.fn.selectFiles=function(){var self=this;E.log("使用 form 方式上传"),self.render(),self.clear(),self.show()},E.UploadFile=UploadFile}}),_e(function(E,$){E.plugin(function(){function findPasteImgAndUpload(){var reg=/^data:(image\/\w+);base64/,$imgs=$txt.find("img");E.log("粘贴后，检查到编辑器有"+$imgs.length+"个图片。开始遍历图片，试图找到刚刚粘贴过来的图片"),$.each($imgs,function(){var flag,type,img=this,$img=$(img),base64=$img.attr("src");$imgsBeforePaste.each(function(){if(img===this)return flag=!0,!1}),flag||(E.log("找到一个粘贴过来的图片"),reg.test(base64)?(E.log("src 是 base64 格式，可以上传"),type=base64.match(reg)[1],editor.xhrUploadImg({event:pasteEvent,base64:base64,fileType:type,name:uploadFileName})):E.log("src 为 "+base64+" ，不是 base64 格式，暂时不支持上传"),$img.remove())}),E.log("遍历结束")}var pasteEvent,$imgsBeforePaste,editor=this,txt=editor.txt,$txt=txt.$txt,config=editor.config,uploadImgUrl=config.uploadImgUrl,uploadFileName=config.uploadImgFileName||"wangEditorPasteFile";uploadImgUrl&&$txt.on("paste",function(e){pasteEvent=e;var text,items,data=pasteEvent.clipboardData||pasteEvent.originalEvent.clipboardData;(text=null==data?window.clipboardData&&window.clipboardData.getData("text"):data.getData("text/plain")||data.getData("text/html"))||(items=data&&data.items,items?(E.log("通过 data.items 得到了数据"),$.each(items,function(key,value){var fileType=value.type||"";if(!(fileType.indexOf("image")<0)){var file=value.getAsFile(),reader=new FileReader;E.log("得到一个粘贴图片"),reader.onload=function(e){E.log("读取到粘贴的图片");var base64=e.target.result||this.result;editor.xhrUploadImg({event:pasteEvent,base64:base64,fileType:fileType,name:uploadFileName})},reader.readAsDataURL(file)}})):(E.log("未从 data.items 得到数据，使用检测粘贴图片的方式"),$imgsBeforePaste=$txt.find("img"),E.log("粘贴前，检查到编辑器有"+$imgsBeforePaste.length+"个图片"),setTimeout(findPasteImgAndUpload,0)))})})}),_e(function(E,$){E.plugin(function(){var editor=this,txt=editor.txt,$txt=txt.$txt,config=editor.config,uploadImgUrl=config.uploadImgUrl,uploadFileName=config.uploadImgFileName||"wangEditorDragFile";uploadImgUrl&&(E.$document.on("dragleave drop dragenter dragover",function(e){e.preventDefault()}),$txt.on("drop",function(dragEvent){dragEvent.preventDefault();var originalEvent=dragEvent.originalEvent,files=originalEvent.dataTransfer&&originalEvent.dataTransfer.files;files&&files.length&&$.each(files,function(k,file){var type=file.type,name=file.name;if(!(type.indexOf("image/")<0)){E.log("得到图片 "+name);var reader=new FileReader;reader.onload=function(e){E.log("读取到图片 "+name);var base64=e.target.result||this.result;editor.xhrUploadImg({event:dragEvent,base64:base64,fileType:type,name:uploadFileName})},reader.readAsDataURL(file)}})}))})}),_e(function(E,$){E.plugin(function(){function render(){isRendered||(bindEvent(),$toolbar.append($triangle).append($delete).append($zoomSmall).append($zoomBig),editor.$editorContainer.append($toolbar),isRendered=!0)}function bindEvent(){function command(e,callback){html=$txt.html();var cb=function(){callback&&callback(),html!==$txt.html()&&$txt.change()};commandFn&&editor.customCommand(e,commandFn,cb)}var commandFn;$delete.click(function(e){commandFn=function(){$currentTable.remove()},command(e,function(){setTimeout(hide,100)})}),$zoomBig.click(function(e){commandFn=function(){$currentTable.css({width:"100%"})},command(e,function(){setTimeout(show)})}),$zoomSmall.click(function(e){commandFn=function(){$currentTable.css({width:"auto"})},command(e,function(){setTimeout(show)})})}function show(){if(!editor._disabled&&null!=$currentTable){$currentTable.addClass("clicked");var tablePosition=$currentTable.position(),tableTop=tablePosition.top,tableLeft=tablePosition.left,tableHeight=$currentTable.outerHeight(),tableWidth=$currentTable.outerWidth(),top=tableTop+tableHeight,left=tableLeft,marginLeft=0,txtTop=$currentTxt.position().top,txtHeight=$currentTxt.outerHeight();top>txtTop+txtHeight&&(top=txtTop+txtHeight),$toolbar.show();marginLeft=tableWidth/2-$toolbar.outerWidth()/2,$toolbar.css({top:top+5,left:left,"margin-left":marginLeft}),marginLeft<0?($toolbar.css("margin-left","0"),$triangle.hide()):$triangle.show()}}function hide(){null!=$currentTable&&($currentTable.removeClass("clicked"),$currentTable=null,$toolbar.hide())}var $currentTable,editor=this,txt=editor.txt,$txt=txt.$txt,html="",$currentTxt=editor.useMaxHeight?$txt.parent():$txt,isRendered=!1,$toolbar=$('<div class="txt-toolbar"></div>'),$triangle=$('<div class="tip-triangle"></div>'),$delete=$('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>'),$zoomSmall=$('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>'),$zoomBig=$('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>');$currentTxt.on("click","table",function(e){var $table=$(e.currentTarget);if(render(),$currentTable&&$currentTable.get(0)===$table.get(0))return void setTimeout(hide,100);$currentTable=$table,show(),e.preventDefault(),e.stopPropagation()}).on("click keydown scroll",function(e){setTimeout(hide,100)}),E.$body.on("click keydown scroll",function(e){setTimeout(hide,100)})})}),_e(function(E,$){E.userAgent.indexOf("MSIE 8")>0||E.plugin(function(){function imgLink(e,url){if($currentImg){var commandFn,$link,callback=function(){null!=url&&(currentLink=url),html!==$txt.html()&&$txt.change()},inLink=!1,$parent=$currentImg.parent();if("a"===$parent.get(0).nodeName.toLowerCase()?($link=$parent,inLink=!0):$link=$('<a target="_blank"></a>'),null==url)return $link.attr("href")||"";if(""===url)inLink&&(commandFn=function(){$currentImg.unwrap()});else{if(url===currentLink)return;commandFn=function(){$link.attr("href",url),inLink||$currentImg.wrap($link)}}commandFn&&(html=$txt.html(),editor.customCommand(e,commandFn,callback))}}function render(){isRendered||(bindToolbarEvent(),bindDragEvent(),$menuContainer.append($delete).append($zoomSmall).append($zoomBig).append($alignLeft).append($alignCenter).append($alignRight).append($link).append($unLink),$linkInputContainer.append($linkInput).append($linkBtnCancel).append($linkBtnSubmit),$toolbar.append($triangle).append($menuContainer).append($linkInputContainer),editor.$editorContainer.append($toolbar).append($dragPoint),isRendered=!0)}function bindToolbarEvent(){function customCommand(e,callback){var cb;html=$txt.html(),cb=function(){callback&&callback(),html!==$txt.html()&&$txt.change()},commandFn&&editor.customCommand(e,commandFn,cb)}var commandFn;$delete.click(function(e){imgLink(e,""),commandFn=function(){$currentImg.remove()},customCommand(e,function(){setTimeout(hide,100)})}),$zoomBig.click(function(e){commandFn=function(){var img=$currentImg.get(0),width=img.width,height=img.height;width*=1.1,height*=1.1,$currentImg.css({width:width+"px",height:height+"px"})},customCommand(e,function(){setTimeout(show)})}),$zoomSmall.click(function(e){commandFn=function(){var img=$currentImg.get(0),width=img.width,height=img.height;width*=.9,height*=.9,$currentImg.css({width:width+"px",height:height+"px"})},customCommand(e,function(){setTimeout(show)})}),$alignLeft.click(function(e){commandFn=function(){$currentImg.parents("p").css({"text-align":"left"}).attr("align","left")},customCommand(e,function(){setTimeout(hide,100)})}),$alignRight.click(function(e){commandFn=function(){$currentImg.parents("p").css({"text-align":"right"}).attr("align","right")},customCommand(e,function(){setTimeout(hide,100)})}),$alignCenter.click(function(e){commandFn=function(){$currentImg.parents("p").css({"text-align":"center"}).attr("align","center")},customCommand(e,function(){setTimeout(hide,100)})}),$link.click(function(e){e.preventDefault(),currentLink=imgLink(e),$linkInput.val(currentLink),$menuContainer.hide(),$linkInputContainer.show()}),$linkBtnSubmit.click(function(e){e.preventDefault();var url=$.trim($linkInput.val());url&&imgLink(e,url),setTimeout(hide)}),$linkBtnCancel.click(function(e){e.preventDefault(),$linkInput.val(currentLink),$menuContainer.show(),$linkInputContainer.hide()}),$unLink.click(function(e){e.preventDefault(),imgLink(e,""),setTimeout(hide)})}function bindDragEvent(){function mousemove(e){var diffX,diffY;diffX=e.pageX-_x,diffY=e.pageY-_y;var currentDragMarginLeft=dragMarginLeft+diffX,currentDragMarginTop=dragMarginTop+diffY;$dragPoint.css({"margin-left":currentDragMarginLeft,"margin-top":currentDragMarginTop});var currentImgWidth=imgWidth+diffX,currentImggHeight=imgHeight+diffY;$currentImg&&$currentImg.css({width:currentImgWidth,height:currentImggHeight})}var _x,_y,dragMarginLeft,dragMarginTop,imgWidth,imgHeight;$dragPoint.on("mousedown",function(e){$currentImg&&(_x=e.pageX,_y=e.pageY,dragMarginLeft=parseFloat($dragPoint.css("margin-left"),10),dragMarginTop=parseFloat($dragPoint.css("margin-top"),10),imgWidth=$currentImg.width(),imgHeight=$currentImg.height(),$toolbar.hide(),E.$document.on("mousemove._dragResizeImg",mousemove),E.$document.on("mouseup._dragResizeImg",function(e){E.$document.off("mousemove._dragResizeImg"),E.$document.off("mouseup._dragResizeImg"),hide(),$dragPoint.css({"margin-left":dragMarginLeft,"margin-top":dragMarginTop}),isOnDrag=!1}),isOnDrag=!0)})}function show(){if(!editor._disabled&&null!=$currentImg){$currentImg.addClass("clicked");var imgPosition=$currentImg.position(),imgTop=imgPosition.top,imgLeft=imgPosition.left,imgHeight=$currentImg.outerHeight(),imgWidth=$currentImg.outerWidth();$dragPoint.css({top:imgTop+imgHeight,left:imgLeft+imgWidth});var top=imgTop+imgHeight,left=imgLeft,marginLeft=0,txtTop=$currentTxt.position().top,txtHeight=$currentTxt.outerHeight();top>txtTop+txtHeight?top=txtTop+txtHeight:$dragPoint.show(),$toolbar.show();marginLeft=imgWidth/2-$toolbar.outerWidth()/2,$toolbar.css({top:top+5,left:left,"margin-left":marginLeft}),marginLeft<0?($toolbar.css("margin-left","0"),$triangle.hide()):$triangle.show(),editor.disableMenusExcept()}}function hide(){null!=$currentImg&&($currentImg.removeClass("clicked"),$currentImg=null,$toolbar.hide(),$dragPoint.hide(),editor.enableMenusExcept())}function isEmotion(imgSrc){var result=!1;return editor.emotionUrls?($.each(editor.emotionUrls,function(index,url){var flag=!1;if(imgSrc===url&&(result=!0,flag=!0),flag)return!1}),result):result}var $currentImg,editor=this,lang=editor.config.lang,txt=editor.txt,$txt=txt.$txt,html="",$currentTxt=editor.useMaxHeight?$txt.parent():$txt,currentLink=(editor.$editorContainer,""),isRendered=!1,$dragPoint=$('<div class="img-drag-point"></div>'),$toolbar=$('<div class="txt-toolbar"></div>'),$triangle=$('<div class="tip-triangle"></div>'),$menuContainer=$("<div></div>"),$delete=$('<a href="#"><i class="wangeditor-menu-img-trash-o"></i></a>'),$zoomSmall=$('<a href="#"><i class="wangeditor-menu-img-search-minus"></i></a>'),$zoomBig=$('<a href="#"><i class="wangeditor-menu-img-search-plus"></i></a>'),$alignLeft=$('<a href="#"><i class="wangeditor-menu-img-align-left"></i></a>'),$alignCenter=$('<a href="#"><i class="wangeditor-menu-img-align-center"></i></a>'),$alignRight=$('<a href="#"><i class="wangeditor-menu-img-align-right"></i></a>'),$link=$('<a href="#"><i class="wangeditor-menu-img-link"></i></a>'),$unLink=$('<a href="#"><i class="wangeditor-menu-img-unlink"></i></a>'),$linkInputContainer=$('<div style="display:none;"></div>'),$linkInput=$('<input type="text" style="height:26px; margin-left:10px; width:200px;"/>'),$linkBtnSubmit=$('<button class="right">'+lang.submit+"</button>"),$linkBtnCancel=$('<button class="right gray">'+lang.cancel+"</button>"),isOnDrag=!1;$currentTxt.on("mousedown","img",function(e){e.preventDefault()}).on("click","img",function(e){var $img=$(e.currentTarget),src=$img.attr("src");if(src&&!isEmotion(src)){if(render(),$currentImg&&$currentImg.get(0)===$img.get(0))return void setTimeout(hide,100);$currentImg=$img,show(),$menuContainer.show(),$linkInputContainer.hide(),e.preventDefault(),e.stopPropagation()}}).on("click keydown scroll",function(e){isOnDrag||setTimeout(hide,100)})})}),_e(function(E,$){E.plugin(function(){function render(){isRendered||($toolbar.append($triangle).append($triggerLink),editor.$editorContainer.append($toolbar),isRendered=!0)}function setPosition(){if($currentLink){var position=$currentLink.position(),left=position.left,top=position.top,height=$currentLink.height(),topResult=top+height+5,menuHeight=editor.menuContainer.height(),txtHeight=editor.txt.$txt.outerHeight();topResult>menuHeight+txtHeight&&(topResult=menuHeight+txtHeight+5),$toolbar.css({top:topResult,left:left})}}function show(){if(!isShow&&$currentLink){render(),$toolbar.show();var href=$currentLink.attr("href");$triggerLink.attr("href",href),setPosition(),isShow=!0}}function hide(){isShow&&$currentLink&&($toolbar.hide(),isShow=!1)}var $currentLink,isRendered,showTimeoutId,hideTimeoutId,showTimeoutIdByToolbar,editor=this,lang=editor.config.lang,$txt=editor.txt.$txt,$toolbar=$('<div class="txt-toolbar"></div>'),$triangle=$('<div class="tip-triangle"></div>'),$triggerLink=$('<a href="#" target="_blank"><i class="wangeditor-menu-img-link"></i> '+lang.openLink+"</a>"),isShow=!1;$txt.on("mouseenter","a",function(e){showTimeoutId&&clearTimeout(showTimeoutId),showTimeoutId=setTimeout(function(){var a=e.currentTarget,$a=$(a);$currentLink=$a;var $img=$a.children("img");$img.length&&($img.click(function(e){hide()}),$img.hasClass("clicked"))||show()},500)}).on("mouseleave","a",function(e){hideTimeoutId&&clearTimeout(hideTimeoutId),hideTimeoutId=setTimeout(hide,500)}).on("click keydown scroll",function(e){setTimeout(hide,100)}),$toolbar.on("mouseenter",function(e){hideTimeoutId&&clearTimeout(hideTimeoutId)}).on("mouseleave",function(e){showTimeoutIdByToolbar&&clearTimeout(showTimeoutIdByToolbar),showTimeoutIdByToolbar=setTimeout(hide,500)})})}),_e(function(E,$){E.plugin(function(){var editor=this,menuFixed=editor.config.menuFixed;if(!1!==menuFixed&&"number"==typeof menuFixed){var bodyMarginTop=parseFloat(E.$body.css("margin-top"),10);isNaN(bodyMarginTop)&&(bodyMarginTop=0);var $editorContainer=editor.$editorContainer,editorTop=$editorContainer.offset().top,editorHeight=$editorContainer.outerHeight(),$menuContainer=editor.menuContainer.$menuContainer,menuCssPosition=$menuContainer.css("position"),menuCssTop=$menuContainer.css("top"),menuTop=$menuContainer.offset().top,menuHeight=$menuContainer.outerHeight();editor.txt.$txt;E.$window.scroll(function(){if(!editor.isFullScreen){var sTop=E.$window.scrollTop(),menuWidth=$menuContainer.width();0===menuTop&&(menuTop=$menuContainer.offset().top,editorTop=$editorContainer.offset().top,editorHeight=$editorContainer.outerHeight(),menuHeight=$menuContainer.outerHeight()),sTop>=menuTop&&sTop+menuFixed+menuHeight+30<editorTop+editorHeight?($menuContainer.css({position:"fixed",top:menuFixed}),$menuContainer.width(menuWidth),E.$body.css({"margin-top":bodyMarginTop+menuHeight}),editor._isMenufixed||(editor._isMenufixed=!0)):($menuContainer.css({position:menuCssPosition,top:menuCssTop}),$menuContainer.css("width","100%"),E.$body.css({"margin-top":bodyMarginTop}),editor._isMenufixed&&(editor._isMenufixed=!1))}})}})}),_e(function(E,$){E.createMenu(function(check){if(check("indent")){var editor=this,menu=new E.Menu({editor:editor,id:"indent",title:"缩进",$domNormal:$('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-indent-left"></i></a>'),$domSelected:$('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-indent-left"></i></a>')});menu.clickEvent=function(e){function commandFn(){$p.css("text-indent","2em")}var $p,elem=editor.getRangeElem(),p=editor.getSelfOrParentByName(elem,"p");if(!p)return e.preventDefault();$p=$(p),editor.customCommand(e,commandFn)},menu.clickEventSelected=function(e){function commandFn(){$p.css("text-indent","0")}var $p,elem=editor.getRangeElem(),p=editor.getSelfOrParentByName(elem,"p");if(!p)return e.preventDefault();$p=$(p),editor.customCommand(e,commandFn)},menu.updateSelectedEvent=function(){var $p,indent,elem=editor.getRangeElem(),p=editor.getSelfOrParentByName(elem,"p");return!!p&&($p=$(p),!(!(indent=$p.css("text-indent"))||"0px"===indent))},editor.menus.indent=menu}})}),_e(function(E,$){E.createMenu(function(check){if(check("lineheight")){var editor=this;editor.commandHooks.lineHeight=function(value){var rangeElem=editor.getRangeElem(),targetElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,pre");targetElem&&$(targetElem).css("line-height",value+"")};var menu=new E.Menu({editor:editor,id:"lineheight",title:"行高",commandName:"lineHeight",$domNormal:$('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-arrows-v"></i></a>'),$domSelected:$('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-arrows-v"></i></a>')}),data={"1.0":"1.0倍",1.5:"1.5倍",1.8:"1.8倍","2.0":"2.0倍",2.5:"2.5倍","3.0":"3.0倍"};menu.dropList=new E.DropList(editor,menu,{data:data,tpl:'<span style="line-height:{#commandValue}">{#title}</span>'}),editor.menus.lineheight=menu}})}),_e(function(E,$){E.plugin(function(){var editor=this;if(editor.config.customUpload){if(editor.config.uploadImgUrl)return alert("自定义上传无效，详看浏览器日志console.log"),void E.error("已经配置了 uploadImgUrl ，就不能再配置 customUpload ，两者冲突。将导致自定义上传无效。");var $uploadContent=editor.$uploadContent;$uploadContent||E.error("自定义上传，无法获取 editor.$uploadContent");var $uploadIcon=$('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');$uploadContent.append($uploadIcon);var btnId="upload"+E.random(),containerId="upload"+E.random();$uploadIcon.attr("id",btnId),$uploadContent.attr("id",containerId),editor.customUploadBtnId=btnId,editor.customUploadContainerId=containerId}})}),_e(function(E,$){E.info("本页面富文本编辑器由 wangEditor 提供 http://wangeditor.github.io/ ")}),window.wangEditor});