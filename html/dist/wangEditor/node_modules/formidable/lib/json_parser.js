function JSONParser(){this.data=new Buffer(""),this.bytesWritten=0}global.GENTLY&&(require=GENTLY.hijack(require));var Buffer=require("buffer").Buffer;exports.JSONParser=JSONParser,JSONParser.prototype.initWithLength=function(length){this.data=new Buffer(length)},JSONParser.prototype.write=function(buffer){return this.data.length>=this.bytesWritten+buffer.length?buffer.copy(this.data,this.bytesWritten):this.data=Buffer.concat([this.data,buffer]),this.bytesWritten+=buffer.length,buffer.length},JSONParser.prototype.end=function(){try{var fields=JSON.parse(this.data.toString("utf8"));for(var field in fields)this.onField(field,fields[field])}catch(e){}this.data=null,this.onEnd()};